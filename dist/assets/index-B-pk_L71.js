import{r as l,t as At,c as It,j as e,V as js,R as bs,a as He,A as Ns,C as ys,X as Me,T as ws,D as vs,P as Dt,b as Et,$ as Rt,d as Ss,e as Ut,f as ks,I as Ft,g as Cs,S as Ts,h as Lt,i as Ps,k as _t,l as As,m as Ot,L as Is,n as Ds,o as $t,p as ts,q as Ht,s as Es,u as Mt,v as Bt,w as zt,x as Rs,y as Us,F as Fs,z as Ls,B as Oe,E as _s,G as Gt,H as Os,J as $s,K as Hs,M as Ms,N as Bs,O as Jt,Q as zs,U as Gs,W as Vt,Y as qt,Z as J,_ as Wt,a0 as is,a1 as K,a2 as Js,a3 as Vs,a4 as se,a5 as Z,a6 as Be,a7 as we,a8 as as,a9 as te,aa as rs,ab as qs,ac as L,ad as ss,ae as Yt,af as Ws,ag as Ys,ah as ve,ai as be,aj as xe,ak as Ye,al as Ks,am as Kt,an as ze,ao as Ce,ap as Qs,aq as Xs,ar as me,as as ns,at as Ne,au as Se,av as Qt,aw as ls,ax as Xt,ay as Zs,az as Zt,aA as ea,aB as sa,aC as ta,aD as et,aE as aa,aF as os,aG as ra,aH as na,aI as la,aJ as ia,aK as $e,aL as fe,aM as st,aN as oa,aO as tt,aP as ca,aQ as at,aR as da,aS as ma,aT as xa,aU as rt,aV as nt,aW as lt,aX as ua,aY as cs,aZ as ha,a_ as ds,a$ as De,b0 as ms,b1 as Ke,b2 as pa,b3 as fa,b4 as xs,b5 as ga,b6 as Ee,b7 as Qe,b8 as ja,b9 as ba,ba as Na,bb as ya,bc as z,bd as wa}from"./vendor-U1v9JUIQ.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const x of i)if(x.type==="childList")for(const o of x.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function a(i){const x={};return i.integrity&&(x.integrity=i.integrity),i.referrerPolicy&&(x.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?x.credentials="include":i.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function r(i){if(i.ep)return;i.ep=!0;const x=a(i);fetch(i.href,x)}})();const va=1,Sa=1e6;let Xe=0;function ka(){return Xe=(Xe+1)%Number.MAX_SAFE_INTEGER,Xe.toString()}const Ze=new Map,us=s=>{if(Ze.has(s))return;const t=setTimeout(()=>{Ze.delete(s),ye({type:"REMOVE_TOAST",toastId:s})},Sa);Ze.set(s,t)},Ca=(s,t)=>{switch(t.type){case"ADD_TOAST":return{...s,toasts:[t.toast,...s.toasts].slice(0,va)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(a=>a.id===t.toast.id?{...a,...t.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=t;return a?us(a):s.toasts.forEach(r=>{us(r.id)}),{...s,toasts:s.toasts.map(r=>r.id===a||a===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return t.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(a=>a.id!==t.toastId)}}},Re=[];let Ue={toasts:[]};function ye(s){Ue=Ca(Ue,s),Re.forEach(t=>{t(Ue)})}function Ta({...s}){const t=ka(),a=i=>ye({type:"UPDATE_TOAST",toast:{...i,id:t}}),r=()=>ye({type:"DISMISS_TOAST",toastId:t});return ye({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:i=>{i||r()}}}),{id:t,dismiss:r,update:a}}function Pa(){const[s,t]=l.useState(Ue);return l.useEffect(()=>(Re.push(t),()=>{const a=Re.indexOf(t);a>-1&&Re.splice(a,1)}),[s]),{...s,toast:Ta,dismiss:a=>ye({type:"DISMISS_TOAST",toastId:a})}}function C(...s){return At(It(s))}const oe=(s,t,a)=>{let r=0;for(let o=0;o<s.length;o++){const h=s.charCodeAt(o);r=(r<<5)-r+h,r=r&r}const i=a-t+1;return Math.abs(r)%i+t},Aa=Dt,it=l.forwardRef(({className:s,...t},a)=>e.jsx(js,{ref:a,className:C("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...t}));it.displayName=js.displayName;const Ia=He("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),ot=l.forwardRef(({className:s,variant:t,...a},r)=>e.jsx(bs,{ref:r,className:C(Ia({variant:t}),s),...a}));ot.displayName=bs.displayName;const Da=l.forwardRef(({className:s,...t},a)=>e.jsx(Ns,{ref:a,className:C("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...t}));Da.displayName=Ns.displayName;const ct=l.forwardRef(({className:s,...t},a)=>e.jsx(ys,{ref:a,className:C("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...t,children:e.jsx(Me,{className:"h-4 w-4"})}));ct.displayName=ys.displayName;const dt=l.forwardRef(({className:s,...t},a)=>e.jsx(ws,{ref:a,className:C("text-sm font-semibold",s),...t}));dt.displayName=ws.displayName;const mt=l.forwardRef(({className:s,...t},a)=>e.jsx(vs,{ref:a,className:C("text-sm opacity-90",s),...t}));mt.displayName=vs.displayName;function Ea(){const{toasts:s}=Pa();return e.jsxs(Aa,{children:[s.map(function({id:t,title:a,description:r,action:i,...x}){return e.jsxs(ot,{...x,children:[e.jsxs("div",{className:"grid gap-1",children:[a&&e.jsx(dt,{children:a}),r&&e.jsx(mt,{children:r})]}),i,e.jsx(ct,{})]},t)}),e.jsx(it,{})]})}const Ra=({...s})=>{const{theme:t="system"}=Et();return e.jsx(Rt,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...s})},Ua=Ut,Fa=l.forwardRef(({className:s,sideOffset:t=4,...a},r)=>e.jsx(Ss,{ref:r,sideOffset:t,className:C("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a}));Fa.displayName=Ss.displayName;const ce=Mt,de=Bt,ne=l.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(ks,{ref:r,className:C("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...a,children:[t,e.jsx(Ft,{asChild:!0,children:e.jsx(Cs,{className:"h-4 w-4 opacity-50"})})]}));ne.displayName=ks.displayName;const xt=l.forwardRef(({className:s,...t},a)=>e.jsx(Ts,{ref:a,className:C("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(Lt,{className:"h-4 w-4"})}));xt.displayName=Ts.displayName;const ut=l.forwardRef(({className:s,...t},a)=>e.jsx(Ps,{ref:a,className:C("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(Cs,{className:"h-4 w-4"})}));ut.displayName=Ps.displayName;const le=l.forwardRef(({className:s,children:t,position:a="popper",...r},i)=>e.jsx(_t,{children:e.jsxs(As,{ref:i,className:C("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:a,...r,children:[e.jsx(xt,{}),e.jsx(Ot,{className:C("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(ut,{})]})}));le.displayName=As.displayName;const La=l.forwardRef(({className:s,...t},a)=>e.jsx(Is,{ref:a,className:C("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...t}));La.displayName=Is.displayName;const _=l.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(Ds,{ref:r,className:C("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx($t,{children:e.jsx(ts,{className:"h-4 w-4"})})}),e.jsx(Ht,{children:t})]}));_.displayName=Ds.displayName;const _a=l.forwardRef(({className:s,...t},a)=>e.jsx(Es,{ref:a,className:C("-mx-1 my-1 h-px bg-muted",s),...t}));_a.displayName=Es.displayName;const Ge=He("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),b=l.forwardRef(({className:s,variant:t,size:a,asChild:r=!1,...i},x)=>{const o=r?zt:"button";return e.jsx(o,{className:C(Ge({variant:t,size:a,className:s})),ref:x,...i})});b.displayName="Button";const ht=l.forwardRef(({className:s,...t},a)=>e.jsx(Rs,{ref:a,className:C("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...t}));ht.displayName=Rs.displayName;const pt=l.forwardRef(({className:s,...t},a)=>e.jsx(Us,{ref:a,className:C("aspect-square h-full w-full",s),...t}));pt.displayName=Us.displayName;const ft=l.forwardRef(({className:s,...t},a)=>e.jsx(Fs,{ref:a,className:C("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...t}));ft.displayName=Fs.displayName;const Oa=Vt,$a=qt,Ha=l.forwardRef(({className:s,inset:t,children:a,...r},i)=>e.jsxs(Ls,{ref:i,className:C("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",s),...r,children:[a,e.jsx(Oe,{className:"ml-auto h-4 w-4"})]}));Ha.displayName=Ls.displayName;const Ma=l.forwardRef(({className:s,...t},a)=>e.jsx(_s,{ref:a,className:C("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t}));Ma.displayName=_s.displayName;const gt=l.forwardRef(({className:s,sideOffset:t=4,...a},r)=>e.jsx(Gt,{children:e.jsx(Os,{ref:r,sideOffset:t,className:C("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a})}));gt.displayName=Os.displayName;const ie=l.forwardRef(({className:s,inset:t,...a},r)=>e.jsx($s,{ref:r,className:C("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",s),...a}));ie.displayName=$s.displayName;const Ba=l.forwardRef(({className:s,children:t,checked:a,...r},i)=>e.jsxs(Hs,{ref:i,className:C("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:a,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ms,{children:e.jsx(ts,{className:"h-4 w-4"})})}),t]}));Ba.displayName=Hs.displayName;const za=l.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(Bs,{ref:r,className:C("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ms,{children:e.jsx(Jt,{className:"h-2 w-2 fill-current"})})}),t]}));za.displayName=Bs.displayName;const Ga=l.forwardRef(({className:s,inset:t,...a},r)=>e.jsx(zs,{ref:r,className:C("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",s),...a}));Ga.displayName=zs.displayName;const Ja=l.forwardRef(({className:s,...t},a)=>e.jsx(Gs,{ref:a,className:C("-mx-1 my-1 h-px bg-muted",s),...t}));Ja.displayName=Gs.displayName;const jt=l.createContext(void 0),bt=({children:s})=>{const[t,a]=l.useState(null),[r,i]=l.useState(null),[x,o]=l.useState(!0),h=async()=>{try{console.log("🔍 Checking session with backend...");const m=await fetch("/auth/profile/session",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(m.ok){const g=await m.json();if(g&&g.id){console.log("✅ Session valid:",g.email||g.name);const I={id:g.id,email:g.email,name:g.name,role:g.role,isAdmin:g.isAdmin||g.role==="admin",username:g.name||g.email?.split("@")[0],github_id:g.id,avatar:g.avatar||g.avatar_url};a(I),i("session"),localStorage.setItem("token","session"),localStorage.setItem("devhub_user",JSON.stringify(I));return}}console.log("❌ No valid session found"),d()}catch(m){console.error("❌ Session check error:",m)}},p=async()=>{const m=new URLSearchParams(window.location.search);m.get("success")==="true"?(console.log("🎉 OAuth success detected! Checking session..."),window.history.replaceState({},document.title,window.location.pathname),await new Promise(g=>setTimeout(g,2e3)),await h()):m.get("auth_error")&&(console.log("❌ OAuth error detected:",m.get("auth_error")),d())},d=()=>{console.log("🔓 Clearing auth state"),a(null),i(null),localStorage.removeItem("token"),localStorage.removeItem("devhub_user")};l.useEffect(()=>{(async()=>{console.log("🚀 Initializing Auth Checker..."),await p();const g=localStorage.getItem("token"),I=localStorage.getItem("devhub_user");if(g&&I)try{const N=JSON.parse(I);console.log("🔍 Found stored auth for:",N.email||N.username),a(N),i(g),await h()}catch(N){console.error("❌ Error parsing stored user:",N),d()}else console.log("🔍 No stored auth found"),await h();o(!1)})()},[]);const n=(m,g)=>{console.log("🔐 Login for:",g.email||g.username);const I={...g,isAdmin:g.role==="admin"||g.isAdmin||!1};a(I),i(m),localStorage.setItem("token",m),localStorage.setItem("devhub_user",JSON.stringify(I)),console.log("✅ Login successful for:",I.email||I.username)},c=m=>{console.log("🔄 Setting user:",m.email||m.username);const g={...m,isAdmin:m.role==="admin"||m.isAdmin||!1};a(g),i("session"),localStorage.setItem("token","session"),localStorage.setItem("devhub_user",JSON.stringify(g)),console.log("✅ User updated:",g.email||g.username)},u=async()=>{console.log("🔐 Starting logout...");try{await fetch("/auth/logout",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}),console.log("✅ Backend logout successful")}catch(m){console.error("❌ Backend logout error:",m)}d(),console.log("✅ Logout complete, redirecting..."),window.location.href="/"};return x?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):e.jsx(jt.Provider,{value:{currentUser:t,token:r,login:n,logout:u,setUser:c,isLoading:x,checkSession:h},children:s})},ae=()=>{const s=l.useContext(jt);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s},Va=()=>{const[s,t]=l.useState(null),[a,r]=l.useState(!0),[i,x]=l.useState(null),{currentUser:o,checkSession:h}=ae(),p=l.useCallback(async(d=0)=>{try{console.log("🔐 Refreshing auth..."),await h(),x(null)}catch(n){if(console.error("🔐 Auth refresh error:",n),d<3)return console.log(`🔐 Retrying auth refresh (${d+1}/3)...`),p(d+1);console.log("🔐 Max retries reached"),x("Unable to verify authentication. Please sign in.")}},[h]);return l.useEffect(()=>{(async()=>{try{console.log("🔐 Starting user check..."),o?(console.log("✅ Using AuthProvider user:",o.email),t({id:o.id,email:o.email,name:o.name||o.email.split("@")[0],avatar:o.avatar,isAdmin:o.isAdmin||!1,role:o.isAdmin?"admin":"user"}),x(null)):(console.log("❌ No user from AuthProvider"),t(null))}catch(m){console.error("❌ Error checking user:",m),t(null)}finally{r(!1)}})();const n=setInterval(()=>{s&&(console.log("🔐 30-second auth check..."),p())},3e4),c=m=>{(m.key==="token"||m.key==="devhub_user")&&(console.log("🔐 Storage changed:",m.key),p())},u=()=>{s&&(console.log("🔐 Window focus - checking auth..."),p())};return window.addEventListener("storage",c),window.addEventListener("focus",u),()=>{window.removeEventListener("storage",c),window.removeEventListener("focus",u),clearInterval(n)}},[o,s,p]),{user:s,isLoading:a,authError:i,refreshAuth:p}},Q=({user:s,onSignOut:t})=>{const{user:a,isLoading:r,authError:i,refreshAuth:x}=Va(),{logout:o}=ae(),[h,p]=l.useState(!1),d=s||a;console.log("🔐 Navbar render - user:",d?d.email:"none","authError:",i);const n=async()=>{try{console.log("🔐 Signing out..."),t?t():o()}catch(m){console.error("❌ Logout error:",m)}},c=async()=>{console.log("🔐 Manual auth refresh triggered"),p(!0),await x(),p(!1)},u=()=>{console.log("🔐 Redirecting to GitHub OAuth..."),window.location.href="/auth/github"};return r&&!s?e.jsx("nav",{className:"bg-white border-b border-gray-200 sticky top-0 z-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs(J,{to:"/",className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"DH"})}),e.jsxs("span",{className:"text-xl font-bold text-gray-900",children:["DevHub",e.jsx("span",{className:"text-blue-600",children:"Connect"})]})]}),e.jsx("div",{className:"w-20 h-8 bg-gray-200 animate-pulse rounded"})]})})}):e.jsx("nav",{className:"bg-white border-b border-gray-200 sticky top-0 z-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs(J,{to:"/",className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"DH"})}),e.jsxs("span",{className:"text-xl font-bold text-gray-900",children:["DevHub",e.jsx("span",{className:"text-blue-600",children:"Connect"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(J,{to:"/guidance",children:e.jsxs(b,{variant:"ghost",className:"flex items-center space-x-2",children:[e.jsx(Wt,{className:"w-4 h-4"}),e.jsx("span",{children:"Guidance"})]})}),d?e.jsxs("div",{"data-auth":"user-info",className:"flex items-center space-x-4",children:[i&&e.jsx(b,{variant:"ghost",size:"sm",onClick:c,disabled:h,className:"text-amber-600 hover:text-amber-700",title:i,children:e.jsx(is,{className:`w-4 h-4 ${h?"animate-spin":""}`})}),e.jsxs(Oa,{children:[e.jsx($a,{asChild:!0,children:e.jsxs(b,{variant:"ghost",className:"relative h-8 w-8 rounded-full",children:[e.jsxs(ht,{className:"h-8 w-8",children:[e.jsx(pt,{src:d.avatar,alt:d.name||d.email}),e.jsx(ft,{children:d.isAdmin?"A":d.name?.charAt(0).toUpperCase()||d.email.charAt(0).toUpperCase()})]}),d.isAdmin&&e.jsx("div",{className:"absolute -top-1 -right-1 h-3 w-3 bg-red-500 border-2 border-white rounded-full",children:e.jsx(K,{className:"h-2 w-2 text-white"})}),i&&e.jsx("div",{className:"absolute -bottom-1 -right-1 h-3 w-3 bg-amber-500 border-2 border-white rounded-full"})]})}),e.jsxs(gt,{className:"w-56",align:"end",forceMount:!0,children:[i&&e.jsxs(ie,{onClick:c,disabled:h,className:"text-amber-600 border-b",children:[e.jsx(is,{className:`mr-2 h-4 w-4 ${h?"animate-spin":""}`}),e.jsx("span",{className:"text-xs",children:"Refresh Session"})]}),d.isAdmin&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs(J,{to:"/admin/dashboard",className:"flex items-center",children:[e.jsx(K,{className:"mr-2 h-4 w-4 text-red-500"}),e.jsx("span",{children:"Admin Dashboard"})]})}),e.jsx(ie,{className:"border-b",children:e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(K,{className:"mr-1 h-3 w-3"}),e.jsx("span",{children:"Administrator"})]})})]}),e.jsx(ie,{asChild:!0,children:e.jsxs(J,{to:"/dashboard",className:"flex items-center",children:[e.jsx(Js,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"My Templates"})]})}),e.jsxs(ie,{onClick:n,children:[e.jsx(Vs,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Sign out"})]})]})]})]}):e.jsx("div",{"data-auth":"sign-in",className:"flex items-center",children:e.jsxs(b,{onClick:u,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white","data-auth":"github","data-auth-nav":"true",children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Continue with GitHub"]})})]})]})})})},P=l.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:C("rounded-lg border bg-card text-card-foreground shadow-sm",s),...t}));P.displayName="Card";const E=l.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:C("flex flex-col space-y-1.5 p-6",s),...t}));E.displayName="CardHeader";const R=l.forwardRef(({className:s,...t},a)=>e.jsx("h3",{ref:a,className:C("text-2xl font-semibold leading-none tracking-tight",s),...t}));R.displayName="CardTitle";const X=l.forwardRef(({className:s,...t},a)=>e.jsx("p",{ref:a,className:C("text-sm text-muted-foreground",s),...t}));X.displayName="CardDescription";const A=l.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:C("p-6 pt-0",s),...t}));A.displayName="CardContent";const qa=l.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:C("flex items-center p-6 pt-0",s),...t}));qa.displayName="CardFooter";const Wa=He("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function B({className:s,variant:t,...a}){return e.jsx("div",{className:C(Wa({variant:t}),s),...a})}const Fe=({template:s,onPreview:t,onTemplateRemoved:a})=>{const r=Z(),[i,x]=l.useState(!1),[o,h]=l.useState(!1),[p,d]=l.useState(!1),n=s.imageUrl||s.image_url||null,c=oe(String(s.id)+"-downloads",45,850),u=s._rating||4+oe(String(s.id)+"-rating",1,9)/10,m=s._reviewCount||oe(String(s.id)+"-reviews",8,120),g=()=>{r(`/template/${s.id}`)},I=async()=>{d(!0);try{console.log(`🛒 Initiating purchase for template ${s.id}`);const j=await fetch("/api/stripe/create-checkout-session",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({templateId:s.id})});if(!j.ok){const w=await j.text();throw console.error("Purchase failed:",w),new Error(`Failed to create checkout session: ${j.status}`)}const S=await j.json();if(S.url)console.log(`✅ Redirecting to Stripe checkout: ${S.url}`),window.location.href=S.url;else throw new Error("No checkout URL received from server")}catch(j){console.error("Purchase error:",j),L.error(`Purchase failed: ${j.message}`)}finally{d(!1)}},N=async()=>{if(console.log("🐛 DEBUG: Full template object:",s),console.log("🐛 DEBUG: Template ID:",s.id),console.log("🐛 DEBUG: Template ID type:",typeof s.id),console.log("🐛 DEBUG: Template purchased:",s.purchased),console.log("🐛 DEBUG: Image URL resolved to:",n),!s.purchased){I();return}if(s.id===void 0||s.id===null){console.error("❌ Template ID is undefined or invalid"),alert("Error: Template ID is missing");return}x(!0);try{const j=`/api/templates/${s.id}/download`;console.log("🐛 DEBUG: Download URL:",j);const S=await fetch(j,{credentials:"include"});if(!S.ok)throw S.status===401?new Error("Please sign in to download templates"):S.status===403?new Error("Template not purchased"):new Error("Failed to download template");const w=S.headers.get("Content-Disposition");let T=`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}.json`;if(w){const v=w.match(/filename="(.+)"/);v&&(T=v[1])}const D=await S.blob(),H=window.URL.createObjectURL(D),M=document.createElement("a");M.href=H,M.download=T,document.body.appendChild(M),M.click(),window.URL.revokeObjectURL(H),document.body.removeChild(M),console.log("✅ Template downloaded:",s.name)}catch(j){console.error("Download error:",j),alert(`Download failed: ${j.message}`)}finally{x(!1)}},f=async()=>{if(window.confirm(`Remove "${s.name}" from your collection?

You can always purchase it again later.`)){h(!0);try{const S=await fetch(`/api/user/purchases/template/${s.id}`,{method:"DELETE",credentials:"include"});if(S.ok){const w=await S.json();L.success(`"${s.name}" removed from collection`),a?.(s.id)}else{const w=await S.json();L.error(w.message||"Failed to remove template")}}catch(S){console.error("Remove template error:",S),L.error("Failed to remove template")}finally{h(!1)}}};return e.jsxs(P,{className:"h-full flex flex-col hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-t-lg",children:[s.imageUrl||s.image_url?e.jsx("img",{src:s.imageUrl||s.image_url,alt:s.name,className:"w-full h-48 object-cover transition-transform duration-300 ease-in-out hover:scale-110",onError:j=>{console.log("🐛 DEBUG: Image failed to load:",n),j.currentTarget.style.display="none",j.currentTarget.parentElement?.querySelector(".image-fallback")?.classList.remove("hidden")}}):null,e.jsx("div",{className:`w-full h-48 bg-gray-100 flex items-center justify-center transition-transform duration-300 ease-in-out hover:scale-110 image-fallback ${s.imageUrl||s.image_url?"hidden":""}`,children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx("div",{className:"text-4xl mb-2",children:"📋"}),e.jsx("div",{className:"text-sm",children:"Workflow Preview"}),!1]})}),e.jsx("div",{className:"absolute top-3 right-3 z-10",children:e.jsx(B,{variant:"secondary",className:"bg-white/90 text-gray-800 font-semibold",children:Number(s.price)===0?"Free":`$${(Number(s.price)/100).toFixed(2)}`})})]}),e.jsx(E,{className:"pb-3",children:e.jsx(R,{className:"text-lg font-semibold line-clamp-2 min-h-[3.5rem]",children:s.name})}),e.jsxs(A,{className:"flex-1 flex flex-col justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600 line-clamp-3 mb-4",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Be,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),e.jsx("span",{className:"font-medium",children:u.toFixed(1)}),m>0&&e.jsxs("span",{className:"text-gray-400",children:["(",m,")"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:c.toLocaleString()})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:`w-full ${s.purchased?"border-gray-300 text-gray-700 hover:bg-gray-50":"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white border-0 shadow-lg"}`,variant:s.purchased?"outline":"default",onClick:N,disabled:i||p,children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600 mr-2"}),"Downloading..."]}):p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Redirecting to Checkout..."]}):s.purchased?e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Download"]}):e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"Purchase JSON Template"]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(b,{variant:"outline",size:"sm",className:"flex-1 border-gray-300 text-gray-700 hover:bg-gray-50",onClick:g,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Preview"]}),s.purchased&&e.jsx(b,{variant:"outline",size:"sm",onClick:f,disabled:o,className:"px-3 border-red-200 text-red-600 hover:bg-red-50 hover:border-red-300",title:`Remove "${s.name}" from collection`,children:o?e.jsx(rs,{className:"h-4 w-4 animate-spin"}):e.jsx(qs,{className:"h-4 w-4"})})]})]})]})]})},W=l.forwardRef(({className:s,type:t,...a},r)=>e.jsx("input",{type:t,className:C("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r,...a}));W.displayName="Input";const Nt=({className:s,...t})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:C("mx-auto flex w-full justify-center",s),...t});Nt.displayName="Pagination";const yt=l.forwardRef(({className:s,...t},a)=>e.jsx("ul",{ref:a,className:C("flex flex-row items-center gap-1",s),...t}));yt.displayName="PaginationContent";const ge=l.forwardRef(({className:s,...t},a)=>e.jsx("li",{ref:a,className:C("",s),...t}));ge.displayName="PaginationItem";const wt=({className:s,isActive:t,size:a="icon",onClick:r,...i})=>e.jsx("button",{"aria-current":t?"page":void 0,onClick:r,className:C(Ge({variant:t?"outline":"ghost",size:a}),s),...i});wt.displayName="PaginationLink";const vt=({className:s,onClick:t,disabled:a,...r})=>e.jsxs("button",{"aria-label":"Go to previous page",onClick:t,disabled:a,className:C(Ge({variant:"ghost",size:"default"}),"gap-1 pl-2.5",s),...r,children:[e.jsx(ss,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});vt.displayName="PaginationPrevious";const St=({className:s,onClick:t,disabled:a,...r})=>e.jsxs("button",{"aria-label":"Go to next page",onClick:t,disabled:a,className:C(Ge({variant:"ghost",size:"default"}),"gap-1 pr-2.5",s),...r,children:[e.jsx("span",{children:"Next"}),e.jsx(Oe,{className:"h-4 w-4"})]});St.displayName="PaginationNext";const kt=({className:s,...t})=>e.jsxs("span",{"aria-hidden":!0,className:C("flex h-9 w-9 items-center justify-center",s),...t,children:[e.jsx(Yt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"More pages"})]});kt.displayName="PaginationEllipsis";class Ya{apiEndpoint;constructor(t="/api/admin/verify-dhc-template"){this.apiEndpoint=t}async validateTemplate(t){return this.isDHCFormat(t)?this.validateDHCFormat(t):this.isN8NFormat(t)?this.validateN8NFormat(t):{valid:!1,error:"Template format not recognized",action:"Please upload either a DevHubConnect verified template or a standard n8n template with 'devhubconnect' tag"}}isDHCFormat(t){return t._dhc_verified&&t.workflow}isN8NFormat(t){return t.meta&&t.name&&t.nodes&&t.connections}async validateDHCFormat(t){const a=t._dhc_verified;if(!a.source||a.source!=="DevHubConnect.com")return{valid:!1,error:"Invalid template source",action:"Only DevHubConnect.com templates are supported"};if(!a.signature||!a.purchaseId)return{valid:!1,error:"Template verification data is incomplete",action:"Please re-download the template from DevHubConnect.com"};try{const r=await fetch(this.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({verification:a,workflowHash:this.hashWorkflow(t.workflow)})}),i=await r.json();return!r.ok||!i.valid?{valid:!1,error:i.error||"Template verification failed",action:"Please ensure you downloaded this template from DevHubConnect.com"}:{valid:!0,purchaseId:a.purchaseId,templateId:a.templateId,workflow:t.workflow,format:"dhc"}}catch{return{valid:!1,error:"Unable to verify template authenticity",action:"Please check your internet connection and try again"}}}validateN8NFormat(t){if(!t.meta?.instanceId)return{valid:!1,error:"Missing meta.instanceId",action:"Standard n8n templates must include meta.instanceId field"};if(!t.name?.trim())return{valid:!1,error:"Missing template name",action:"Template must have a valid name"};if(!t.tags?.includes("devhubconnect"))return{valid:!1,error:"Template must include 'devhubconnect' tag",action:"Add 'devhubconnect' to the tags array to use this template"};const a=this.validateWorkflowContent(t);return a.valid?{valid:!0,templateId:`n8n_${t.meta.instanceId}`,workflow:t,format:"n8n"}:a}validateWorkflowContent(t){return!Array.isArray(t.nodes)||t.nodes.length<3?{valid:!1,error:"Template must have at least 3 nodes",action:"Create a workflow with at least 3 connected nodes"}:!t.connections||typeof t.connections!="object"?{valid:!1,error:"Template must have connections object",action:"Ensure your workflow has proper node connections"}:t.nodes.filter(r=>!r.id||!r.name||!r.type||!r.position).length>0?{valid:!1,error:"Some nodes are missing required properties",action:"All nodes must have id, name, type, and position properties"}:{valid:!0}}hashWorkflow(t){return btoa(JSON.stringify(t)).slice(0,32)}async handleFileUpload(t){try{const a=await t.text(),r=JSON.parse(a),i=await this.validateTemplate(r);if(!i.valid)throw new Error(i.error+". "+i.action);return i}catch(a){throw a instanceof SyntaxError?new Error("Invalid JSON file. Please upload a valid DevHubConnect template or n8n workflow."):a}}}const Ka=()=>{const[s,t]=l.useState(!1),[a,r]=l.useState(null),[i,x]=l.useState(null),o=new Ya,h=l.useCallback(async d=>{t(!0),r(null),x(null);try{const n=await o.handleFileUpload(d);return x(n),n}catch(n){const c=n instanceof Error?n.message:"Unknown error occurred";throw r(c),n}finally{t(!1)}},[]),p=l.useCallback(()=>{r(null),x(null)},[]);return{validateTemplate:h,clearValidation:p,isValidating:s,validationError:a,validatedTemplate:i,isValid:!!i}},Qa=({onTemplateValidated:s,onPreviewTemplate:t})=>{const a=l.useRef(null),[r,i]=l.useState(!1),{validateTemplate:x,clearValidation:o,isValidating:h,validationError:p,validatedTemplate:d}=Ka(),n=async N=>{const f=N.target.files?.[0];if(f){if(!f.name.endsWith(".json")){alert("Please upload a .json file");return}try{const j=await x(f);s?.(j)}catch(j){console.error("Template validation failed:",j)}}},c=N=>{N.preventDefault(),i(!1);const f=N.dataTransfer.files[0];if(f&&f.name.endsWith(".json")){const j=new DataTransfer;if(j.items.add(f),a.current){a.current.files=j.files;const S=new Event("change",{bubbles:!0});Object.defineProperty(S,"target",{writable:!1,value:a.current}),n(S)}}},u=N=>{N.preventDefault(),i(!0)},m=N=>{N.preventDefault(),i(!1)},g=()=>{a.current&&(a.current.value=""),o()},I=()=>{if(d&&t){const N={id:d.templateId,name:d.metadata?.name||"Uploaded Template",description:d.metadata?.description||"Template uploaded from DevHubConnect",price:0,workflowJson:d.workflowJson,purchased:!0,hasAccess:!0};t(N)}};return e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx(P,{children:e.jsx(A,{className:"p-6",children:e.jsxs("div",{className:`
            relative border-2 border-dashed rounded-xl p-8 text-center transition-all duration-300 min-h-[300px] flex flex-col items-center justify-center cursor-pointer
            ${r?"border-blue-400 bg-blue-50":""}
            ${h?"border-yellow-400 bg-yellow-50":""}
            ${p?"border-red-400 bg-red-50":""}
            ${d?"border-green-400 bg-green-50":"border-gray-300 hover:border-blue-400 hover:bg-gray-50"}
          `,onDrop:c,onDragOver:u,onDragLeave:m,onClick:()=>a.current?.click(),children:[e.jsx("input",{ref:a,type:"file",accept:".json",onChange:n,className:"hidden",id:"template-file-input"}),!d&&!h&&!p&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ws,{className:"h-16 w-16 mx-auto text-gray-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"Upload DevHubConnect Template"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Select your .json template file to get started"}),e.jsxs(b,{variant:"outline",className:"mx-auto",onClick:N=>{N.stopPropagation(),a.current?.click()},children:[e.jsx(Ys,{className:"h-4 w-4 mr-2"}),"Browse Files"]})]}),e.jsxs("div",{className:"text-xs text-gray-400 space-y-1",children:[e.jsx("p",{children:"✓ Only templates purchased from DevHubConnect.com are supported"}),e.jsx("p",{children:"✓ File must be in .json format"}),e.jsx("p",{children:"✓ Maximum file size: 10MB"})]})]}),h&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(rs,{className:"h-16 w-16 mx-auto text-yellow-500 animate-spin"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-yellow-700 mb-2",children:"Validating Template..."}),e.jsx("p",{className:"text-yellow-600",children:"Verifying your DevHubConnect purchase"}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("div",{className:"w-full bg-yellow-200 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-500 h-2 rounded-full animate-pulse w-3/4"})}),e.jsx("p",{className:"text-sm text-yellow-600",children:"This may take a few seconds..."})]})]})]}),p&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(ve,{className:"h-16 w-16 mx-auto text-red-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-red-700 mb-2",children:"Validation Failed"}),e.jsx("p",{className:"text-red-600 mb-4 max-w-md mx-auto",children:p}),e.jsx(b,{onClick:g,variant:"outline",children:"Try Another File"})]})]}),d&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(be,{className:"h-16 w-16 mx-auto text-green-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-green-700 mb-2",children:"Template Verified Successfully!"}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs(B,{variant:"secondary",className:"bg-green-100 text-green-800",children:["Purchase ID: ",d.purchaseId]}),e.jsxs(B,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:["Template: ",d.templateId]})]}),e.jsxs("div",{className:"space-y-3",children:[t&&e.jsx(b,{onClick:I,className:"w-full",children:"Preview Template"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(b,{onClick:g,variant:"outline",className:"flex-1",children:"Upload Different Template"}),e.jsx(b,{onClick:()=>{console.log("Import to workspace:",d)},className:"flex-1",children:"Import to Workspace"})]})]})]})]})]})})})})},Xa=({validatedTemplate:s,onClose:t,onBack:a,onGoHome:r,onGoToDashboard:i})=>{const[x,o]=l.useState([{id:"1",role:"assistant",content:`✅ **Template loaded successfully!**

📄 **Template:** ${s.templateId}
🔑 **Purchase ID:** ${s.purchaseId}

🤖 I'm ready to help you set up this n8n workflow. Ask me anything about:

• **Credentials setup** - "How do I add API keys?"
• **Testing workflows** - "How do I test this?"
• **Troubleshooting** - "My workflow isn't working"
• **Specific nodes** - "How do I configure the Slack node?"

What would you like to know?`,timestamp:new Date}]),[h,p]=l.useState(""),[d,n]=l.useState(!1),c=l.useRef(null),u=l.useRef(null),m=()=>{c.current?.scrollIntoView({behavior:"smooth"})};l.useEffect(()=>{m()},[x]);const g=async()=>{if(!h.trim()||d)return;const f={id:Date.now().toString(),role:"user",content:h.trim(),timestamp:new Date};o(j=>[...j,f]),p(""),n(!0);try{const j=await fetch("/api/ask-ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:f.content,templateContext:{templateId:s.templateId,purchaseId:s.purchaseId,hasValidTemplate:!0}})});if(!j.ok)throw new Error("AI request failed");const S=await j.json(),w={id:(Date.now()+1).toString(),role:"assistant",content:S.response||"Sorry, I encountered an error. Please try again.",timestamp:new Date};o(T=>[...T,w])}catch(j){console.error("Chat error:",j);const S={id:(Date.now()+1).toString(),role:"assistant",content:"❌ Sorry, I encountered an error. Please try again or check your connection.",timestamp:new Date};o(w=>[...w,S])}finally{n(!1)}},I=f=>{f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),g())},N=async f=>{try{await navigator.clipboard.writeText(f),alert("Response copied to clipboard!"),console.log("✅ Text copied to clipboard")}catch(j){console.error("❌ Failed to copy text:",j);try{const S=document.createElement("textarea");S.value=f,document.body.appendChild(S),S.select(),document.execCommand("copy"),document.body.removeChild(S),alert("Response copied to clipboard!"),console.log("✅ Text copied using fallback method")}catch(S){console.error("❌ Fallback copy method also failed:",S),alert("Could not copy to clipboard. Please select and copy the text manually.")}}};return e.jsxs("div",{className:"fixed inset-0 bg-white z-50 flex flex-col",children:[e.jsxs("div",{className:"border-b border-gray-200 bg-white px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[a&&e.jsx(b,{variant:"ghost",size:"sm",onClick:a,children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Ye,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"DevHubConnect Setup Assistant"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.templateId})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{variant:"secondary",className:"bg-green-100 text-green-800",children:"✓ Verified Template"}),i&&e.jsx(b,{variant:"outline",size:"sm",onClick:i,children:"Dashboard"}),r&&e.jsx(b,{variant:"outline",size:"sm",onClick:r,children:"Home"}),e.jsx(b,{variant:"ghost",size:"sm",onClick:t,children:e.jsx(Me,{className:"h-5 w-5"})})]})]}),e.jsx("div",{className:"bg-blue-50 border-b border-blue-200 px-6 py-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ys,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-blue-800 font-medium",children:"Template:"}),e.jsx("span",{className:"text-blue-700",children:s.templateId})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-blue-800 font-medium",children:"Purchase ID:"}),e.jsx("span",{className:"text-blue-700",children:s.purchaseId})]})]})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6 space-y-6",children:[x.map(f=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${f.role==="assistant"?"bg-blue-100":"bg-gray-100"}`,children:f.role==="assistant"?e.jsx(Ye,{className:"h-5 w-5 text-blue-600"}):e.jsx(Ks,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:f.role==="assistant"?"DevHubConnect Assistant":"You"}),e.jsx("span",{className:"text-xs text-gray-500",children:f.timestamp.toLocaleTimeString()})]}),e.jsx("div",{className:`prose prose-sm max-w-none ${f.role==="assistant"?"text-gray-800":"text-gray-700 bg-gray-50 rounded-lg px-4 py-3"}`,children:e.jsx("pre",{className:"whitespace-pre-wrap font-sans text-sm leading-relaxed",children:f.content})}),f.role==="assistant"&&e.jsx(b,{variant:"ghost",size:"sm",className:"mt-2 text-xs text-gray-500 hover:text-gray-700",onClick:()=>N(f.content),children:"Copy response"})]})]},f.id)),d&&e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Ye,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"DevHubConnect Assistant"}),e.jsx("span",{className:"text-xs text-gray-500",children:"thinking..."})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})]}),e.jsx("div",{ref:c})]}),e.jsxs("div",{className:"border-t border-gray-200 bg-white px-6 py-4",children:[e.jsxs("div",{className:"flex gap-3 items-end",children:[e.jsx("div",{className:"flex-1 relative",children:e.jsx("textarea",{ref:u,value:h,onChange:f=>p(f.target.value),onKeyPress:I,placeholder:"Ask me about setting up your n8n workflow...",className:"w-full resize-none rounded-lg border border-gray-300 px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:Math.min(Math.max(h.split(`
`).length,1),4),disabled:d})}),e.jsx(b,{onClick:g,disabled:!h.trim()||d,className:"px-4 py-3",children:e.jsx(Kt,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:"Press Enter to send, Shift + Enter for new line"})]})]})};function Za(){const[s,t]=l.useState(""),[a,r]=l.useState([{role:"assistant",text:"👋 Welcome! Please upload your DevHubConnect template (.json file) to get started with setup instructions."}]),[i,x]=l.useState(!1),[o,h]=l.useState(null),[p,d]=l.useState(!1),n=Z(),c=async N=>{h(N),d(!0);const f={role:"assistant",text:`✅ Template verified successfully!

📄 Template: ${N.templateId}
🔑 Purchase ID: ${N.purchaseId}

🤖 Now generating detailed setup instructions...`};r(j=>[...j,f]),x(!0);try{const j=await fetch("/api/generate-setup-instructions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({workflow:N.workflow,templateId:N.templateId,purchaseId:N.purchaseId})});if(!j.ok)throw new Error(`HTTP error! status: ${j.status}`);const S=await j.json();if(S.instructions){const w={role:"assistant",text:`📋 **Setup Instructions for ${N.templateId}**

${S.instructions}

💬 You can now ask me questions about this template or request specific help with the setup process.`};r(T=>[...T,w])}else throw new Error("No instructions received from API")}catch(j){const S={role:"assistant",text:`❌ Error generating setup instructions: ${j instanceof Error?j.message:"Unknown error"}

You can still ask me questions about your template manually.`};r(w=>[...w,S])}finally{x(!1)}},u=async()=>{if(!s.trim())return;const N={role:"user",text:s},f=[...a,N];r(f),t(""),x(!0);try{const j=f.map(D=>({role:D.role==="user"?"user":"assistant",content:D.text})),S={prompt:N.text,history:j};o&&(S.templateContext={templateId:o.templateId,purchaseId:o.purchaseId,hasValidTemplate:!0});const w=await fetch("/api/ask-ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)});if(!w.ok){let D=`HTTP error! status: ${w.status}`;try{const H=await w.json();D+=`, details: ${JSON.stringify(H)}`}catch{const M=await w.text();D+=`, raw response: ${M}`}r(H=>[...H,{role:"assistant",text:`⚠️ Backend error: ${D}`}]);return}const T=await w.json();if(T.response){const D={role:"assistant",text:T.response};r(H=>[...H,D])}else r(D=>[...D,{role:"assistant",text:"⚠️ AI response format unexpected."}])}catch(j){r(S=>[...S,{role:"assistant",text:`⚠️ Failed to get response: ${j instanceof Error?j.message:String(j)}`}])}finally{x(!1)}},m=N=>{N.key==="Enter"&&u()},g=()=>{h(null),d(!1),r([{role:"assistant",text:"👋 Welcome! Please upload your DevHubConnect template (.json file) to get started with setup instructions."}]),t("")},I=()=>{const N=a.find(f=>f.role==="assistant"&&f.text.includes("Setup Instructions for"));N&&(navigator.clipboard.writeText(N.text),alert("Setup instructions copied to clipboard!"))};return e.jsxs(e.Fragment,{children:[p&&o&&e.jsx(Xa,{validatedTemplate:o,onClose:()=>{d(!1),g()},onBack:()=>{d(!1),g()},onGoHome:()=>{g(),n("/")},onGoToDashboard:()=>{g(),n("/dashboard")}}),!p&&e.jsxs("div",{className:"p-4 border rounded-md w-full shadow-md font-sans bg-white max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 pb-3 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"DevHubConnect Setup Assistant"}),o&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:I,className:"px-3 py-1 bg-green-500 text-white text-sm rounded hover:bg-green-600 transition-colors",children:"📋 Copy Instructions"}),e.jsx("button",{onClick:g,className:"px-3 py-1 bg-gray-500 text-white text-sm rounded hover:bg-gray-600 transition-colors",children:"🔄 New Template"})]})]}),!o&&e.jsx("div",{className:"mb-6",children:e.jsx(Qa,{onTemplateValidated:c})}),o&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-green-700",children:[e.jsx("span",{className:"text-lg",children:"✅"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["Template: ",o.templateId]}),e.jsxs("div",{className:"text-sm opacity-75",children:["Purchase ID: ",o.purchaseId]})]})]})}),e.jsxs("div",{className:"h-96 overflow-y-auto space-y-3 mb-4 bg-gray-50 p-4 rounded-lg border border-gray-200",children:[a.map((N,f)=>e.jsx("div",{className:`text-sm p-3 rounded-lg shadow-sm ${N.role==="user"?"bg-blue-500 text-white ml-auto max-w-[85%] text-right":"bg-white text-gray-800 mr-auto max-w-[90%] text-left border border-gray-200"}`,style:{wordBreak:"break-word"},children:e.jsx("pre",{className:"whitespace-pre-wrap font-sans",children:N.text})},f)),i&&e.jsx("div",{className:"text-sm italic text-gray-500 p-3 text-center",children:e.jsx("span",{className:"inline-block animate-pulse",children:"🤖 AI is thinking..."})})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ask questions about your template setup...",value:s,onChange:N=>t(N.target.value),onKeyDown:m,disabled:i}),e.jsx("button",{onClick:u,className:"mt-3 w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-200 ease-in-out shadow-md disabled:opacity-50 disabled:cursor-not-allowed",disabled:i||!s.trim(),children:"Send Message"})]})]})]})}const er="https://devhubconnect-production.up.railway.app",Y=er,Te={AUTH_SESSION:`${Y}/auth/profile/session`,AUTH_LOGOUT:`${Y}/auth/logout`,AUTH_GITHUB:`${Y}/auth/github`,AUTH_ADMIN_LOGIN:`${Y}/auth/admin/login`,TEMPLATES:`${Y}/api/templates`,TEMPLATE_BY_ID:s=>`${Y}/api/templates/${s}`,ASK_AI:`${Y}/api/ask-ai`,RECOMMENDATIONS:`${Y}/api/recommendations`,PURCHASES:`${Y}/api/user/purchases`,CREATE_CHECKOUT:`${Y}/api/stripe/create-checkout-session`},Pe=async(s,t={})=>{const a={credentials:"include",headers:{"Content-Type":"application/json",...t.headers}};return fetch(s,{...a,...t})},sr=async()=>{const s=await Pe(Te.TEMPLATES);if(!s.ok)throw new Error("Network response was not ok");return(await s.json()).templates},tr=async s=>{try{await fetch("/api/templates/analytics/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({searchTerm:s,timestamp:new Date().toISOString()})})}catch(t){console.log("Search analytics tracking failed:",t)}},ar=(s,t,a=1)=>{const r=a*2+5,i=[20,40,60,80,100].filter(m=>m<t);if(t<=r&&t>0)return Array.from({length:t},(m,g)=>g+1);if(t===0)return[];const x=Math.max(s-a,1),o=Math.min(s+a,t),h=1,p=t;let d=new Set;d.add(h),d.add(p);for(let m=x;m<=o;m++)d.add(m);d.add(s),i.forEach(m=>d.add(m));let n=Array.from(d).sort((m,g)=>m-g);const c=[];let u=null;for(const m of n)u!==null&&typeof u=="number"&&m>u+1&&c.push("..."),c.push(m),u=m;return c},rr=()=>{const{data:s=[],isLoading:t,error:a}=ze({queryKey:["templates"],queryFn:sr}),r=Ce(),i=Z(),x=l.useMemo(()=>{const v=new URLSearchParams(r.search),G=parseInt(v.get("page")||"1",10);return Math.max(1,G)},[r.search]),[o,h]=l.useState(""),[p,d]=l.useState("all"),[n,c]=l.useState("all"),[u,m]=l.useState(x),g=9;l.useEffect(()=>{const v=new URLSearchParams(r.search);u!==1?v.set("page",u.toString()):v.delete("page"),i(`?${v.toString()}`,{replace:!0})},[u,r.search,i]);const I=["all","popular","email","database","webhooks","social","marketing"],N=l.useMemo(()=>{let v=Array.isArray(s)?s:[];if(p==="popular")return v=v.filter(U=>U.description.toLowerCase().includes("llm")||U.name.toLowerCase().includes("llm")),v.sort((U,V)=>V.downloads-U.downloads),v;p!=="all"&&(v=v.filter(U=>U.description.toLowerCase().includes(p.toLowerCase())||U.name.toLowerCase().includes(p.toLowerCase()))),o&&(v=v.filter(U=>U.name.toLowerCase().includes(o.toLowerCase())||U.description.toLowerCase().includes(o.toLowerCase())));const G=[...v];switch(n){case"popular":G.sort((U,V)=>V.downloads-U.downloads);break;case"newest":G.sort((U,V)=>new Date(V.createdAt).getTime()-new Date(U.createdAt).getTime());break;case"price_asc":G.sort((U,V)=>U.price-V.price);break;case"price_desc":G.sort((U,V)=>V.price-U.price);break}return G},[s,p,o,n]),f=Math.ceil(N.length/g);l.useEffect(()=>{u>f&&f>0?m(f):f===0&&u!==1&&m(1)},[u,f]);const j=(u-1)*g,S=j+g,w=N.slice(j,S),T=ar(u,f),D=v=>{v==="popular"?c("popular"):n==="popular"&&c("newest"),d(v),m(1)},H=v=>{c(v),m(1)},M=v=>{h(v),m(1),v.trim()&&tr(v.trim())};return t?e.jsx("div",{className:"text-center p-10",children:"Loading Marketplace..."}):a?e.jsx("div",{className:"text-center p-10 text-red-500",children:"Error: Failed to load templates. Is the backend server running?"}):e.jsx(Qs,{children:e.jsxs(e.Fragment,{children:[e.jsx(Xs,{children:e.jsx("title",{children:"Automation Templates | DevHubConnect"})}),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Q,{}),e.jsx("section",{className:"bg-gradient-to-r from-blue-600 via-purple-600 to-blue-800 text-white py-20",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[e.jsx("h1",{className:"text-5xl font-bold mb-6",children:"Premium Templates & Support"}),e.jsxs("p",{className:"text-xl mb-8 text-blue-100 max-w-3xl mx-auto",children:["We won't just hand you the solution, we'll build it for you.",e.jsx("br",{}),"Upload your template and get step by step assistance from our AI.",e.jsx("br",{}),"Save hours of development time with instantly deployable n8n solutions."]}),e.jsxs("div",{className:"flex justify-center space-x-8 text-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(me,{className:"w-8 h-8 mb-2"}),e.jsxs("span",{className:"text-2xl font-bold",children:[s.length,"+"]}),e.jsx("span",{className:"text-blue-100",children:"Templates"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(ns,{className:"w-8 h-8 mb-2"}),e.jsx("span",{className:"text-2xl font-bold",children:"7000+"}),e.jsx("span",{className:"text-blue-100",children:"Users"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Be,{className:"w-8 h-8 mb-2"}),e.jsx("span",{className:"text-2xl font-bold",children:"4.9"}),e.jsx("span",{className:"text-blue-100",children:"Rating"})]})]})]})}),e.jsx("section",{className:"py-8 bg-white border-b sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 w-full md:max-w-xs",children:[e.jsx(Ne,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(W,{placeholder:"Search templates...",className:"pl-10",value:o,onChange:v=>M(v.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[e.jsx(Se,{className:"h-4 w-4 text-gray-500 flex-shrink-0"}),I.map(v=>e.jsxs(B,{variant:p===v?"default":"outline",className:"cursor-pointer hover:bg-blue-100 transition-colors capitalize whitespace-nowrap",onClick:()=>D(v),children:[v==="popular"&&e.jsx(me,{className:"w-3 h-3 mr-1.5"}),v]},v))]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Qt,{className:"h-4 w-4 text-gray-500"}),e.jsxs(ce,{value:n,onValueChange:H,children:[e.jsx(ne,{className:"w-[180px]",children:e.jsx(de,{placeholder:"Sort by"})}),e.jsxs(le,{children:[e.jsx(_,{value:"popular",children:"Popularity"}),e.jsx(_,{value:"newest",children:"Newest"}),e.jsx(_,{value:"price_asc",children:"Price: Low to High"}),e.jsx(_,{value:"price_desc",children:"Price: High to Low"})]})]})]})]})})}),e.jsx("section",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"Available Templates"}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(ls,{className:"w-5 h-5 mr-2"}),e.jsxs("span",{children:[N.length," templates found"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:w.map(v=>e.jsx(Fe,{template:v},v.id))}),N.length===0&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"🔍"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No templates found"}),e.jsx("p",{className:"text-gray-600",children:"Try adjusting your search terms or filters"}),e.jsx(b,{variant:"outline",className:"mt-4",onClick:()=>{h(""),d("all"),m(1)},children:"Clear Filters"})]}),f>1&&e.jsx("div",{className:"mt-12 flex justify-center",children:e.jsx(Nt,{children:e.jsxs(yt,{children:[e.jsx(ge,{children:e.jsx(vt,{href:`?page=${u-1}`,onClick:v=>{v.preventDefault(),u>1&&m(u-1)},className:u===1?"pointer-events-none opacity-50":""})}),T.map((v,G)=>typeof v=="number"?e.jsx(ge,{children:e.jsx(wt,{href:`?page=${v}`,onClick:U=>{U.preventDefault(),m(v)},isActive:u===v,children:v})},`${v}-${G}`):e.jsx(ge,{children:e.jsx(kt,{})},`${v}-${G}`)),e.jsx(ge,{children:e.jsx(St,{href:`?page=${u+1}`,onClick:v=>{v.preventDefault(),u<f&&m(u+1)},className:u===f?"pointer-events-none opacity-50":""})})]})})})]})}),e.jsx("section",{className:"py-12 bg-white-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-6",children:"Need Assistance? Ask Our AI!"}),e.jsx("p",{className:"text-lg text-gray-600 mb-8",children:"Upload your .json file to get AI help deploying your n8n template or answering related questions.."}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(Za,{})," "]})]})}),e.jsx("footer",{className:"bg-white-800 text-white py-12 border-t-[6px] border-white",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"})})]})]})})},nr=Xt("pk_test_51RgVfSBS72lorg0VlXnIXjmsGBjriHLK36isBNmKnsbYjkHmTkz6Rp0hK0QboFaJLnzl0qA2FyLMq3hA5ofFEneN005HATkECJ"),lr=s=>{if(!s.workflowJson&&!s.workflow_json)return;const t=`/api/templates/${s.id}/download-workflow`,a=document.createElement("a");a.href=t,a.download=`${s.name.toLowerCase().replace(/\s+/g,"_")}_workflow.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a)},ir=s=>{if(!s)return[];const t=s.map(a=>{const r=a.type.split(".");return r.length>1?r[r.length-1]:r[0]});return Array.from(new Set(t))};async function or(s){if(!s||s.trim()==="")throw new Error("No template ID provided");const t=await Pe(Te.TEMPLATE_BY_ID(s),{method:"GET"});if(!t.ok)throw t.status===404?new Error(`Template with ID "${s}" not found`):new Error("Failed to fetch template details.");return(await t.json()).template}const cr=()=>{const{id:s}=Zs(),t=Ce(),[a,r]=l.useState(!1),{currentUser:i}=ae(),x=s;if(!x||x.trim()==="")return e.jsx("div",{className:"text-center p-12 text-red-500",children:"Error: No template ID provided in URL."});const{data:o,isLoading:h,error:p}=ze({queryKey:["template",x],queryFn:()=>or(x)});if(h)return e.jsx("div",{className:"text-center p-12",children:"Loading Marketplace..."});if(p)return e.jsxs("div",{className:"text-center p-12 text-red-500",children:["Error: ",p.message]});if(!o)return e.jsx("div",{className:"text-center p-12",children:"Template not found."});const d=o.imageUrl||o.image_url;console.log("🔍 Template Debug Info:",{templateId:o.id,templateName:o.name,imageUrl:o.imageUrl,image_url:o.image_url,finalImageUrl:d,workflowJson:o.workflowJson,workflow_json:o.workflow_json,hasImageUrl:!!d,imageUrlType:typeof d,imageUrlLength:d?.length});const c=new URLSearchParams(t.search).get("page"),u=c?`/?page=${c}`:"/",m=oe(String(o.id),16,92),g=oe(String(o.id)+"-views",300,1500),I=(4+oe(String(o.id)+"-rating",1,9)/10).toFixed(1),N=o.workflowJson?.nodes||o.workflow_json?.nodes,f=o.integratedApps||o.workflowDetails?.apps||ir(N),j=o.steps||o.workflowDetails?.steps||N?.length||0,S=i?.role==="admin"||i?.isAdmin||!1,w=async()=>{r(!0);try{if(!await nr){console.error("Stripe.js failed to load."),L.error("Payment system not available. Please try again later.",{description:"Stripe.js failed to load."});return}const D=await Pe(Te.CREATE_CHECKOUT,{method:"POST",body:JSON.stringify({templateId:o.id})});if(!D.ok){const M=await D.text();throw console.error("Backend error response:",M),new Error(`Failed to create checkout session. Server responded with: ${D.status} ${D.statusText}. Response: ${M.substring(0,100)}...`)}const H=await D.json();window.location.href=H.url}catch(T){console.error("Error during purchase:",T),L.error("Purchase failed",{description:T.message})}finally{r(!1)}};return e.jsx(Qs,{children:e.jsxs(e.Fragment,{children:[e.jsx(Xs,{children:e.jsxs("title",{children:[o.name," | DevHubConnect"]})}),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Q,{}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs(J,{to:u,className:"text-blue-600 hover:underline flex items-center",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Back to All Templates"]}),S&&e.jsx(J,{to:`/admin/templates/${x}/edit`,children:e.jsxs(b,{variant:"outline",children:[e.jsx(Zt,{className:"w-4 h-4 mr-2"}),"Edit Template"]})})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4",children:o.name}),e.jsx("p",{className:"text-gray-600 mb-6",children:o.description}),e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Visual Preview"}),e.jsx("div",{className:"p-4 border rounded-lg bg-gray-100 flex justify-center items-center",children:d?e.jsx("img",{src:d,alt:`${o.name} preview`,className:"max-w-full h-auto rounded-md",onLoad:()=>console.log("✅ Image loaded successfully:",d),onError:T=>{console.error("❌ Image failed to load:",d),console.error("Error details:",T)}}):e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"No visual preview available."}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:['Debug: imageUrl = "',o.imageUrl,'", image_url = "',o.image_url,'"']})]})})]})}),e.jsx("div",{children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsxs("p",{className:"text-4xl font-bold mb-4",children:["$",(o.price/100).toFixed(2)]}),o.purchased?e.jsxs("div",{className:"space-y-3",children:[e.jsxs(b,{size:"lg",className:"w-full bg-blue-600 hover:bg-blue-700",onClick:()=>lr(o),children:[e.jsx(we,{className:"w-5 h-5 mr-2"}),"Download JSON"]}),e.jsxs(b,{size:"lg",variant:"secondary",className:"w-full",onClick:()=>alert("Logic to copy workflow to be implemented!"),children:[e.jsx(ea,{className:"w-5 h-5 mr-2"}),"Copy to My Workflows"]})]}):e.jsx(b,{size:"lg",className:"w-full bg-purple-600 hover:bg-purple-700",onClick:w,disabled:a,children:a?"Redirecting to Checkout...":e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"w-5 h-5 mr-2"}),"Purchase JSON Template"]})}),e.jsx("p",{className:"text-center text-xs text-gray-500 mt-3",children:"✅ Instant download after purchase"}),e.jsxs("div",{className:"mt-6 pt-6 border-t",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Workflow Details"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm font-semibold text-gray-600 mb-3",children:[e.jsx(sa,{className:"w-4 h-4 mr-2"}),"Steps Included"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j>0?e.jsxs("span",{className:"bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full",children:[j," steps in workflow"]}):e.jsx("p",{className:"text-xs text-gray-500",children:"No steps defined."})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm font-semibold text-gray-600 mb-3",children:[e.jsx(ta,{className:"w-4 h-4 mr-2"}),"Integrated Apps"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:f&&f.length>0?f.map(T=>e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium capitalize px-2.5 py-1 rounded-full",children:T},T)):e.jsx("p",{className:"text-xs text-gray-500",children:"No specific app integrations."})})]})]}),e.jsxs("ul",{className:"mt-6 space-y-3 text-sm text-gray-700 pt-6 border-t",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx(Be,{className:"w-4 h-4 mr-2 text-yellow-500"}),I," (",m," reviews)"]},"reviews"),e.jsxs("li",{className:"flex items-center",children:[e.jsx(te,{className:"w-4 h-4 mr-2 text-gray-500"}),g,"+ views"]},"views")]})]})})]})]})]})]})})},ke=l.forwardRef(({className:s,...t},a)=>e.jsx("textarea",{className:C("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:a,...t}));ke.displayName="Textarea";const dr=He("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),O=l.forwardRef(({className:s,...t},a)=>e.jsx(et,{ref:a,className:C(dr(),s),...t}));O.displayName=et.displayName;async function mr(s){if(!s)throw new Error("No template ID provided");const t=await fetch(`/api/templates/${s}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch template.");return(await t.json()).template}async function xr(s){if(!s.id)throw new Error("No ID provided for update");console.log("🔧 Sending update data:",s);const t=await fetch(`/api/templates/${s.id}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok){const a=await t.text();throw console.error("❌ Server error response:",a),new Error(`Failed to update template: ${t.status} ${t.statusText}`)}return t.json()}async function ur(s){if(!s)throw new Error("No ID provided for deletion");const t=await fetch(`/api/templates/${s}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!t.ok){const a=await t.json().catch(()=>({message:"Failed to delete template."}));throw new Error(a.message||"Failed to delete template.")}return t.json()}const hs=()=>{const{id:s}=Zs(),t=Z(),a=aa(),{data:r,isLoading:i,error:x}=ze({queryKey:["template",s],queryFn:()=>mr(s)}),[o,h]=l.useState(""),[p,d]=l.useState(""),[n,c]=l.useState(""),[u,m]=l.useState(""),[g,I]=l.useState("");l.useEffect(()=>{r&&(console.log("Template data received:",r),console.log("workflowJson field:",r.workflowJson),console.log("workflow_json field:",r.workflow_json),h(r.name),d(r.description),c((r.price/100).toFixed(2)),m(JSON.stringify(r.workflowJson||r.workflow_json||{},null,2)),I(r.imageUrl||r.image_url||""))},[r]);const N=os({mutationFn:xr,onSuccess:()=>{a.invalidateQueries({queryKey:["templates"]}),a.invalidateQueries({queryKey:["template",s]}),t(`/template/${s}`)},onError:T=>{console.error("❌ Update mutation error:",T),alert(`Update failed: ${T.message}`)}}),f=os({mutationFn:ur,onSuccess:()=>{a.invalidateQueries({queryKey:["templates"]}),alert("Template deleted successfully!"),t("/")},onError:T=>{console.error("Delete error:",T),alert(`Deletion failed: ${T.message}`)}}),j=T=>{T.preventDefault();try{const D={id:s,name:o,description:p,image_url:g,price:Math.round(parseFloat(n)*100),workflow_json:JSON.parse(u)};console.log("🚀 Submitting update:",D),N.mutate(D)}catch(D){console.error("❌ JSON parse error:",D),alert("Invalid JSON format in workflow.")}},S=async T=>{T.preventDefault();try{const D={id:s,name:o,description:p,image_url:g,price:Math.round(parseFloat(n)*100),workflow_json:JSON.parse(u)};console.log("🚀 Save and view:",D),await N.mutateAsync(D),t(`/template/${s}`)}catch(D){console.error("❌ Save and view error:",D),alert("Invalid JSON format in workflow or update failed.")}},w=()=>{window.confirm("Are you sure you want to delete this template? This cannot be undone.")&&(console.log("Attempting to delete template with ID:",s),f.mutate(s))};return i?e.jsx("div",{children:"Loading editor..."}):x?e.jsx("div",{children:"Error loading template data."}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Q,{}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs(b,{variant:"ghost",onClick:()=>t(`/template/${s}`),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Back to Template"]}),e.jsxs(b,{variant:"destructive",onClick:w,disabled:f.isPending,type:"button",children:[e.jsx(qs,{className:"w-4 h-4 mr-2"}),f.isPending?"Deleting...":"Delete Template"]})]}),e.jsxs(P,{className:"max-w-3xl mx-auto",children:[e.jsx(E,{children:e.jsx(R,{children:"Edit Template"})}),e.jsx(A,{children:e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"name",children:"Template Name"}),e.jsx(W,{id:"name",value:o,onChange:T=>h(T.target.value)})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"description",children:"Description"}),e.jsx(ke,{id:"description",value:p,onChange:T=>d(T.target.value),rows:4})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"imageUrl",children:"Image URL"}),e.jsx(W,{id:"imageUrl",value:g,onChange:T=>I(T.target.value)})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"price",children:"Price (USD)"}),e.jsx(W,{id:"price",type:"number",step:"0.01",value:n,onChange:T=>c(T.target.value)})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"workflowJson",children:"Workflow JSON"}),e.jsx(ke,{id:"workflowJson",value:u,onChange:T=>m(T.target.value),rows:20,className:"font-mono text-xs"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(b,{type:"submit",disabled:N.isPending,className:"flex-1",children:[e.jsx(ra,{className:"w-4 h-4 mr-2"}),N.isPending?"Saving...":"Save Changes"]}),e.jsxs(b,{type:"button",onClick:S,disabled:N.isPending,variant:"secondary",className:"flex-1",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Save & View Template"]})]}),N.isError&&e.jsxs("p",{className:"text-red-500 text-center",children:["Error: ",N.error.message]})]})})]})]})]})};function hr(){const[s,t]=l.useState(""),[a,r]=l.useState(""),[i,x]=l.useState(!1),[o,h]=l.useState(!1),p=Z(),d=async c=>{c.preventDefault(),x(!0),r("");try{const u=await Pe(Te.AUTH_ADMIN_LOGIN,{method:"POST",body:JSON.stringify({password:s})}),m=await u.json();u.ok&&m.success?(localStorage.setItem("token",m.token),localStorage.setItem("devhub_user",JSON.stringify({id:m.user.id,email:m.user.email,name:m.user.name,isAdmin:!0,role:"admin"})),localStorage.setItem("admin_auth","true"),console.log("✅ Admin login successful!"),window.location.href="/admin/dashboard"):r(m.message||"Login failed. Please try again.")}catch(u){console.error("Login error:",u),r("An error occurred. Please check the server and try again.")}finally{x(!1)}},n=()=>{p("/")};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"flex items-center justify-center mb-4",children:[e.jsx(K,{className:"h-12 w-12 text-purple-400 mr-3"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Admin Portal"}),e.jsxs(B,{variant:"secondary",className:"mt-2 bg-purple-600 text-white",children:[e.jsx(K,{className:"h-3 w-3 mr-1"}),"Administrator Access"]})]})]}),e.jsx("p",{className:"text-slate-300",children:"Secure access to DevHubConnect administration"})]}),e.jsxs(P,{className:"border-slate-700 bg-slate-800/50 backdrop-blur",children:[e.jsxs(E,{className:"text-center",children:[e.jsxs(R,{className:"text-white flex items-center justify-center",children:[e.jsx(K,{className:"h-5 w-5 mr-2 text-purple-400"}),"Admin Login"]}),e.jsx(X,{className:"text-slate-300",children:"Enter the admin password to access the dashboard."})]}),e.jsxs(A,{children:[e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(W,{id:"password",type:o?"text":"password",placeholder:"Admin Password",value:s,onChange:c=>t(c.target.value),className:"bg-slate-700 border-slate-600 text-white placeholder:text-slate-400 focus:border-purple-400 pr-10",required:!0}),e.jsx(b,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 text-slate-400 hover:text-white",onClick:()=>h(!o),children:o?e.jsx(na,{className:"h-4 w-4"}):e.jsx(te,{className:"h-4 w-4"})})]})}),a&&e.jsxs("div",{className:"flex items-start space-x-2 p-3 bg-red-900/20 border border-red-700/50 rounded-lg",children:[e.jsx(ve,{className:"h-4 w-4 text-red-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-red-300",children:a})]}),e.jsxs("div",{className:"flex items-start space-x-2 p-3 bg-amber-900/20 border border-amber-700/50 rounded-lg",children:[e.jsx(ve,{className:"h-4 w-4 text-amber-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-xs text-amber-200",children:[e.jsx("strong",{children:"Security Notice:"})," Admin access is logged and monitored."]})]}),e.jsx(b,{type:"submit",disabled:i,className:"w-full bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white shadow-lg",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Logging In..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Access Admin Panel"]})})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-slate-700",children:e.jsxs(b,{variant:"ghost",onClick:n,className:"w-full text-slate-400 hover:text-white",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Back to DevHubConnect"]})})]})]}),e.jsxs("div",{className:"text-center mt-6 text-slate-400 text-sm",children:[e.jsx("p",{children:"DevHubConnect Admin Portal v1.0"}),e.jsx("p",{className:"mt-1",children:"Secure • Monitored • Encrypted"})]})]})})}function pr(){const[s,t]=l.useState(""),[a,r]=l.useState(""),[i,x]=l.useState(""),[o,h]=l.useState(""),[p,d]=l.useState(""),[n,c]=l.useState(null),[u,m]=l.useState(null),[g,I]=l.useState(""),[N,f]=l.useState(!1),[j,S]=l.useState(!1),[w,T]=l.useState(!1),D=l.useRef(null),{currentUser:H,logout:M}=ae(),[v,G]=l.useState(""),[U,V]=l.useState(""),[ue,Ae]=l.useState(!1),he=Z(),Je=H&&(H.role==="admin"||H.isAdmin),Ve=()=>{M(),L.success("Signed out successfully",{description:"You have been logged out of the admin dashboard."})},re=y=>{const k=y.target.files?.[0];if(k){c(k);const F=new FileReader;F.onloadend=()=>{m(F.result)},F.readAsDataURL(k)}},pe=async()=>{if(!n)return null;const y="e455c3f6195ecac9921db8cd4cf02357",k=new FormData;k.append("image",n);const $=await(await fetch(`https://api.imgbb.com/1/upload?key=${y}`,{method:"POST",body:k})).json();if($.success)return $.data.url;throw new Error($.error?.message||"Image upload failed.")},Ie=async y=>{y.preventDefault(),S(!0),I(""),f(!1);try{let k=p;n&&(k=await pe()||"");const F=JSON.parse(o),$=await fetch("/api/templates",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s,description:a,price:parseFloat(i),workflowJson:F,imageUrl:k})}),ee=await $.json();if($.ok)L.success("Upload successful!",{description:"Template has been added to the marketplace."}),I("Upload successful!"),t(""),r(""),x(""),h(""),d(""),c(null),m(null);else throw $.status===409?new Error(ee.message||"Template with this workflow JSON already exists."):new Error(ee.message||"An unknown error occurred during upload.")}catch(k){f(!0),I(`Upload failed: ${k.message}`),L.error("Upload Failed",{description:k.message})}finally{S(!1)}},q=async y=>{y.preventDefault(),S(!0),I(""),f(!1);try{let k=p;n&&(k=await pe()||"");const F=JSON.parse(o),$=await fetch("/api/templates",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s,description:a,price:parseFloat(i),workflowJson:F,imageUrl:k})}),ee=await $.json();if($.ok)L.success("Upload successful!",{description:"Template has been added to the marketplace."}),he(`/templates/${ee.template.id}`);else throw $.status===409?new Error(ee.message||"Template with this workflow JSON already exists."):new Error(ee.message||"An unknown error occurred during upload.")}catch(k){f(!0),I(`Upload failed: ${k.message}`),L.error("Upload Failed",{description:k.message})}finally{S(!1)}},qe=async()=>{if(T(!0),I(""),f(!1),!o.trim()){f(!0),I("Please paste Workflow JSON to generate details."),L.error("Missing JSON",{description:"Please paste Workflow JSON to generate details."}),T(!1);return}try{const y=JSON.parse(o),k=await fetch("/api/admin/generate-template-details",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({workflowJson:y})}),F=await k.json();if(k.ok)t(F.name),r(F.description),x((F.price/100).toFixed(2)),L.success("Details Generated!",{description:"AI has suggested template name, description, and price."}),I("Details generated successfully!");else throw k.status===409?new Error(F.message||"Template with this workflow JSON already exists."):new Error(F.error||F.message||"An unknown error occurred during AI generation.")}catch(y){f(!0),I(`AI generation failed: ${y.message}`),L.error("AI Generation Failed",{description:y.message})}finally{T(!1)}},We=async y=>{y.preventDefault(),Ae(!0),V("");try{const k=await fetch("/api/admin/login",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:v})}),F=await k.json();k.ok&&F.success?(L.success("Admin Login Successful!",{description:"Welcome to the dashboard."}),window.location.reload()):(V(F.message||"Login failed. Please check your password."),L.error("Login Failed",{description:F.message||"Invalid password."}))}catch(k){V(`Login failed: ${k.message}`),L.error("Login Failed",{description:k.message})}finally{Ae(!1)}};return Je?e.jsx("div",{className:"container mx-auto py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Admin Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Manage your marketplace and view analytics."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(b,{onClick:()=>he("/"),variant:"outline",className:"flex items-center text-blue-600 border-blue-300 hover:bg-blue-50 hover:border-blue-400",children:[e.jsx(ia,{className:"w-4 h-4 mr-2"}),"Home"]}),e.jsxs(b,{onClick:Ve,variant:"outline",className:"flex items-center text-red-600 border-red-300 hover:bg-red-50 hover:border-red-400",children:[e.jsx(Vs,{className:"w-4 h-4 mr-2"}),"Sign Out"]})]})]}),e.jsxs(P,{children:[e.jsxs(E,{children:[e.jsx(R,{children:"Analytics & Management"}),e.jsx(X,{children:"View marketplace insights and performance data."})]}),e.jsx(A,{children:e.jsxs(b,{onClick:()=>he("/admin/analytics"),className:"w-full bg-green-600 hover:bg-green-700 mb-4",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"View Analytics"]})})]}),e.jsxs(P,{children:[e.jsxs(E,{children:[e.jsx(R,{children:"Upload New Template"}),e.jsx(X,{children:"Upload a new workflow template."})]}),e.jsx(A,{children:e.jsxs("form",{onSubmit:Ie,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"name",children:"Template Name"}),e.jsx(W,{id:"name",value:s,onChange:y=>t(y.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"description",children:"Description"}),e.jsx(ke,{id:"description",value:a,onChange:y=>r(y.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{children:"Preview Image"}),e.jsx("div",{className:"p-4 border-2 border-dashed rounded-lg text-center",children:u?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:u,alt:"Preview",className:"max-w-full h-auto rounded-md mx-auto"}),e.jsx("button",{type:"button",onClick:()=>{c(null),m(null),D.current&&(D.current.value="")},className:"absolute top-2 right-2 bg-black bg-opacity-50 text-white rounded-full p-1 hover:bg-opacity-75",children:e.jsx(Me,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-32",children:[e.jsx(Ws,{className:"w-8 h-8 text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Drag & drop or click to upload"}),e.jsx(b,{type:"button",variant:"outline",onClick:()=>D.current?.click(),children:"Select Screenshot"}),e.jsx(W,{ref:D,type:"file",className:"hidden",onChange:re,accept:"image/png, image/jpeg, image/gif"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"price",children:"Price (USD)"}),e.jsx(W,{id:"price",type:"number",step:"0.01",min:"0",value:i,onChange:y=>x(y.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"workflowJson",children:"Workflow JSON"}),e.jsx(ke,{id:"workflowJson",value:o,onChange:y=>h(y.target.value),required:!0,rows:10}),e.jsx(b,{type:"button",onClick:qe,className:"w-full mt-2 bg-blue-600 hover:bg-blue-700",disabled:w||j,children:w?e.jsx(e.Fragment,{children:"Generating..."}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"AI Generated Details"]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(b,{type:"submit",className:"flex-1",disabled:j||w,children:j?"Uploading...":"Upload Workflow"}),e.jsxs(b,{type:"button",onClick:q,disabled:j||w,variant:"secondary",className:"flex-1",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Upload & View Template"]})]}),g&&e.jsx("p",{className:`mt-4 text-sm text-center ${N?"text-red-500":"text-green-500"}`,children:g})]})})]})]})}):e.jsx("div",{className:"container mx-auto py-8",children:e.jsxs(P,{className:"max-w-md mx-auto",children:[e.jsxs(E,{children:[e.jsx(R,{children:"Admin Login"}),e.jsx(X,{children:"Enter the admin password to access the dashboard."})]}),e.jsx(A,{children:e.jsxs("form",{onSubmit:We,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"adminPassword",children:"Password"}),e.jsx(W,{id:"adminPassword",type:"password",value:v,onChange:y=>G(y.target.value),required:!0,disabled:ue})]}),U&&e.jsx("p",{className:"text-red-500 text-sm text-center",children:U}),e.jsx(b,{type:"submit",className:"w-full",disabled:ue,children:ue?e.jsx(e.Fragment,{children:"Logging In..."}):e.jsxs(e.Fragment,{children:[e.jsx(la,{className:"w-4 h-4 mr-2"}),"Login"]})})]})})]})})}const ps=()=>{const s=Z(),t=Ce(),[a,r]=l.useState(!1),[i,x]=l.useState(null),{login:o}=ae(),h=t.state?.from||"/dashboard";l.useEffect(()=>{p();const c=new URLSearchParams(window.location.search),u=c.get("auth"),m=c.get("error");u==="success"?d():m&&(x("Authentication failed. Please try again."),r(!1))},[]);const p=async()=>{try{(await fetch("/api/auth/user",{credentials:"include"})).ok&&s(h,{replace:!0})}catch{console.log("User not authenticated")}},d=async()=>{try{r(!0);const c=await fetch("/api/auth/user",{credentials:"include"});if(c.ok){const u=await c.json();console.log("✅ Authentication successful:",u.user?.username||u.user?.email),o("github-auth-token",u.user),window.history.replaceState({},document.title,window.location.pathname),s(h,{replace:!0})}else x("Authentication verification failed. Please try again.")}catch(c){console.error("Auth verification error:",c),x("Something went wrong. Please try again.")}finally{r(!1)}},n=()=>{r(!0),x(null),h!=="/dashboard"&&sessionStorage.setItem("auth_redirect",h),window.location.href="/auth/github"};return a?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4",children:e.jsx(P,{className:"w-full max-w-md border-0 shadow-xl",children:e.jsx(A,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx(rs,{className:"h-8 w-8 animate-spin text-blue-600"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Signing you in..."})]})})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"text-center mb-8",children:e.jsxs(J,{to:"/",className:"inline-flex items-center space-x-2",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-lg",children:"DH"})}),e.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:["DevHub",e.jsx("span",{className:"text-blue-600",children:"Connect"})]})]})}),e.jsxs(P,{className:"border-0 shadow-xl",children:[e.jsxs(E,{className:"text-center pb-4",children:[e.jsx(R,{className:"text-2xl",children:"Welcome"}),e.jsx(X,{children:"Sign in with GitHub to access premium automation templates"})]}),e.jsxs(A,{children:[i&&e.jsx("div",{className:"mb-4 p-3 rounded-md bg-red-50 border border-red-200",children:e.jsx("p",{className:"text-sm text-red-700",children:i})}),e.jsxs(b,{variant:"outline",className:"w-full bg-gray-900 hover:bg-gray-800 text-white border-gray-900",onClick:n,disabled:a,"data-auth":"github","data-auth-primary":"sign-in",children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Continue with GitHub"]}),e.jsx("div",{"data-auth":"user-info",style:{display:"none"},className:"mt-4 p-4 bg-green-50 rounded-lg border border-green-200"}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-white px-2 text-gray-500",children:"Secure GitHub Authentication"})})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs(J,{to:"/",className:"inline-flex items-center text-sm text-gray-600 hover:text-blue-600 transition-colors",children:[e.jsx(xe,{className:"mr-1 h-3 w-3"}),"Back to marketplace"]}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsx("p",{children:"By continuing, you agree to our Terms of Service"}),e.jsx("p",{children:"Your GitHub profile will be used to create your account"})]})]})]})]})]})})},Ct=l.forwardRef(({className:s,...t},a)=>e.jsx(st,{ref:a,className:C("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...t,children:e.jsx(oa,{className:C("flex items-center justify-center text-current"),children:e.jsx(ts,{className:"h-4 w-4"})})}));Ct.displayName=st.displayName;const fr=["startup","small_business","enterprise","agency","freelancer","consultant"],gr=["technology","healthcare","finance","education","retail","manufacturing","real_estate","marketing","consulting","e_commerce","saas","other"],jr=["automation","integration","analytics","communication","productivity","sales","marketing","customer_support","data_processing","workflow"],br=["lead_generation","customer_onboarding","email_marketing","data_sync","report_generation","task_automation","notification_systems","content_management"],Nr=["gmail","slack","stripe","notion","github","trello","shopify","google_sheets","discord","webhook","database","api"],fs=({onPreferencesUpdate:s,className:t=""})=>{const[a,r]=l.useState({maxPrice:5e3,preferredCategories:[],workflows:[],integrations:[]}),[i,x]=l.useState(!1);l.useEffect(()=>{const n=localStorage.getItem("user_preferences");if(n)try{const c=JSON.parse(n);r(u=>({...u,...c}))}catch(c){console.error("Error loading saved preferences:",c)}},[]);const o=async n=>{n.preventDefault();try{localStorage.setItem("user_preferences",JSON.stringify(a)),s(a),L.success("Preferences saved! Recommendations will be updated.",{description:"We'll use these preferences to personalize your recommendations."}),x(!1)}catch{L.error("Failed to save preferences")}},h=n=>{r(c=>({...c,preferredCategories:c.preferredCategories?.includes(n)?c.preferredCategories.filter(u=>u!==n):[...c.preferredCategories||[],n]}))},p=n=>{r(c=>({...c,workflows:c.workflows?.includes(n)?c.workflows.filter(u=>u!==n):[...c.workflows||[],n]}))},d=n=>{r(c=>({...c,integrations:c.integrations?.includes(n)?c.integrations.filter(u=>u!==n):[...c.integrations||[],n]}))};return i?e.jsxs(P,{className:`${t}`,children:[e.jsx(E,{children:e.jsxs(R,{className:"flex items-center space-x-2",children:[e.jsx(ca,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"Business Preferences"})]})}),e.jsx(A,{children:e.jsxs("form",{onSubmit:o,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"businessType",children:"Business Type"}),e.jsxs(ce,{value:a.businessType,onValueChange:n=>r(c=>({...c,businessType:n})),children:[e.jsx(ne,{children:e.jsx(de,{placeholder:"Select business type"})}),e.jsx(le,{children:fr.map(n=>e.jsx(_,{value:n,children:n.replace("_"," ").replace(/\b\w/g,c=>c.toUpperCase())},n))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(O,{htmlFor:"teamSize",className:"flex items-center space-x-1",children:[e.jsx(ns,{className:"h-4 w-4"}),e.jsx("span",{children:"Team Size"})]}),e.jsx(W,{type:"number",id:"teamSize",min:"1",max:"1000",value:a.teamSize||"",onChange:n=>r(c=>({...c,teamSize:n.target.value?Number(n.target.value):void 0})),placeholder:"e.g., 5"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"industry",children:"Industry"}),e.jsxs(ce,{value:a.industry,onValueChange:n=>r(c=>({...c,industry:n})),children:[e.jsx(ne,{children:e.jsx(de,{placeholder:"Select industry"})}),e.jsx(le,{children:gr.map(n=>e.jsx(_,{value:n,children:n.replace("_"," ").replace(/\b\w/g,c=>c.toUpperCase())},n))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"maxPrice",children:"Max Budget per Template"}),e.jsxs(ce,{value:a.maxPrice?.toString(),onValueChange:n=>r(c=>({...c,maxPrice:Number(n)})),children:[e.jsx(ne,{children:e.jsx(de,{placeholder:"Select budget"})}),e.jsxs(le,{children:[e.jsx(_,{value:"1000",children:"Up to $10"}),e.jsx(_,{value:"2500",children:"Up to $25"}),e.jsx(_,{value:"5000",children:"Up to $50"}),e.jsx(_,{value:"10000",children:"Up to $100"}),e.jsx(_,{value:"25000",children:"Up to $250"}),e.jsx(_,{value:"999999",children:"No limit"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(O,{className:"flex items-center space-x-1",children:[e.jsx(ls,{className:"h-4 w-4"}),e.jsx("span",{children:"Interested Categories"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:jr.map(n=>e.jsx(B,{variant:a.preferredCategories?.includes(n)?"default":"outline",className:"cursor-pointer hover:bg-blue-100 transition-colors",onClick:()=>h(n),children:n.replace("_"," ").replace(/\b\w/g,c=>c.toUpperCase())},n))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(O,{children:"Common Workflows"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:br.map(n=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ct,{checked:a.workflows?.includes(n),onCheckedChange:()=>p(n)}),e.jsx("label",{className:"text-sm cursor-pointer",children:n.replace("_"," ").replace(/\b\w/g,c=>c.toUpperCase())})]},n))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(O,{children:"Tools & Integrations You Use"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Nr.map(n=>e.jsx(B,{variant:a.integrations?.includes(n)?"default":"outline",className:"cursor-pointer hover:bg-green-100 transition-colors",onClick:()=>d(n),children:n.replace("_"," ").replace(/\b\w/g,c=>c.toUpperCase())},n))})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx(b,{type:"submit",className:"flex-1",children:"Save Preferences"}),e.jsx(b,{type:"button",variant:"outline",onClick:()=>x(!1),children:"Cancel"})]})]})})]}):e.jsx(P,{className:`hover:shadow-md transition-shadow ${t}`,children:e.jsx(A,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(tt,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Personalize Recommendations"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Tell us about your business to get better suggestions"})]})]}),e.jsx(b,{onClick:()=>x(!0),variant:"outline",size:"sm",children:"Setup"})]})})})},Tt=l.forwardRef(({className:s,...t},a)=>e.jsxs(at,{ref:a,className:C("relative flex w-full touch-none select-none items-center",s),...t,children:[e.jsx(da,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(ma,{className:"absolute h-full bg-primary"})}),e.jsx(xa,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));Tt.displayName=at.displayName;const yr=["automation","integration","analytics","communication","productivity","sales","marketing","customer_support","data_processing","workflow"],gs=({onFiltersChange:s,className:t=""})=>{const[a,r]=l.useState({maxPrice:1e4,minRating:0,sortBy:"recommended",includePersonalized:!0,categories:[]}),[i,x]=l.useState(!1),o=()=>{s(a),x(!1)},h=()=>{const n={maxPrice:1e4,minRating:0,sortBy:"recommended",includePersonalized:!0,categories:[]};r(n),s(n)},p=n=>{r(c=>({...c,categories:c.categories?.includes(n)?c.categories.filter(u=>u!==n):[...c.categories||[],n]}))},d=(a.categories?.length||0)+(a.maxPrice!==1e4?1:0)+(a.minRating!==0?1:0)+(a.sortBy!=="recommended"?1:0);return i?e.jsxs(P,{className:`${t}`,children:[e.jsx(E,{children:e.jsxs(R,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center space-x-2",children:[e.jsx(Se,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"Filter Recommendations"})]}),e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>x(!1),children:e.jsx(Me,{className:"h-4 w-4"})})]})}),e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{children:"Sort By"}),e.jsxs(ce,{value:a.sortBy,onValueChange:n=>r(c=>({...c,sortBy:n})),children:[e.jsx(ne,{children:e.jsx(de,{})}),e.jsxs(le,{children:[e.jsx(_,{value:"recommended",children:"Recommended for You"}),e.jsx(_,{value:"popular",children:"Most Popular"}),e.jsx(_,{value:"rating",children:"Highest Rated"}),e.jsx(_,{value:"newest",children:"Newest First"}),e.jsx(_,{value:"price_low",children:"Price: Low to High"}),e.jsx(_,{value:"price_high",children:"Price: High to Low"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(O,{children:["Max Price: $",(a.maxPrice/100).toFixed(2)]}),e.jsx(Tt,{value:[a.maxPrice],onValueChange:([n])=>r(c=>({...c,maxPrice:n})),min:0,max:25e3,step:500,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Free"}),e.jsx("span",{children:"$250+"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{children:"Minimum Rating"}),e.jsxs(ce,{value:a.minRating?.toString(),onValueChange:n=>r(c=>({...c,minRating:Number(n)})),children:[e.jsx(ne,{children:e.jsx(de,{})}),e.jsxs(le,{children:[e.jsx(_,{value:"0",children:"Any Rating"}),e.jsx(_,{value:"3",children:"3+ Stars"}),e.jsx(_,{value:"4",children:"4+ Stars"}),e.jsx(_,{value:"4.5",children:"4.5+ Stars"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(O,{children:"Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:yr.map(n=>e.jsx(B,{variant:a.categories?.includes(n)?"default":"outline",className:"cursor-pointer hover:bg-blue-100 transition-colors",onClick:()=>p(n),children:n.replace("_"," ").replace(/\b\w/g,c=>c.toUpperCase())},n))})]}),e.jsxs("div",{className:"flex space-x-3 pt-4 border-t",children:[e.jsx(b,{onClick:o,className:"flex-1",children:"Apply Filters"}),e.jsx(b,{variant:"outline",onClick:h,children:"Clear All"})]})]})]}):e.jsx(P,{className:`hover:shadow-md transition-shadow ${t}`,children:e.jsx(A,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Se,{className:"h-5 w-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Filters"}),e.jsx("p",{className:"text-sm text-gray-600",children:d>0?`${d} active filters`:"Refine your search"})]})]}),e.jsxs(b,{onClick:()=>x(!0),variant:"outline",size:"sm",children:[d>0&&e.jsx(B,{variant:"secondary",className:"mr-2 h-5 w-5 rounded-full p-0 text-xs",children:d}),"Filter"]})]})})})},wr=ua,Pt=l.forwardRef(({className:s,...t},a)=>e.jsx(rt,{ref:a,className:C("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...t}));Pt.displayName=rt.displayName;const Le=l.forwardRef(({className:s,...t},a)=>e.jsx(nt,{ref:a,className:C("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...t}));Le.displayName=nt.displayName;const _e=l.forwardRef(({className:s,...t},a)=>e.jsx(lt,{ref:a,className:C("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));_e.displayName=lt.displayName;const vr=s=>{const[t,a]=l.useState({maxPrice:1e4,minRating:0,includePersonalized:!0}),[r,i]=l.useState({}),x=l.useCallback(()=>{const u=new URLSearchParams;return u.append("userId",s),t.maxPrice&&u.append("maxPrice",t.maxPrice.toString()),t.minRating&&u.append("minRating",t.minRating.toString()),t.includePersonalized!==void 0&&u.append("includePersonalized",t.includePersonalized.toString()),t.categories?.length&&t.categories.forEach(m=>u.append("categories",m)),u.toString()},[s,t]),{data:o,isLoading:h,error:p,refetch:d}=ze({queryKey:["enhanced-recommendations",s,t],queryFn:async()=>{const u=x(),m=await Pe(`${Te.RECOMMENDATIONS}?${u}`);if(!m.ok)throw new Error("Failed to fetch recommendations");return m.json()},staleTime:120*1e3}),n=l.useCallback(u=>{a(m=>({...m,...u}))},[]),c=l.useCallback(async u=>{i(u);try{await fetch("/api/recommendations/preferences",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:s,preferences:u})})}catch(m){console.error("Failed to save preferences:",m)}d()},[s,d]);return{recommendations:o?.recommendations||[],metadata:o?.metadata,isLoading:h,error:p,filters:t,preferences:r,updateFilters:n,updatePreferences:c,refetch:d}},Sr="user_123",kr=()=>{const[s,t]=l.useState("overview"),[a,r]=l.useState(!1),[i,x]=l.useState(!1),o=6,[h,p]=l.useState(1),d=6,[n,c]=l.useState(1),{recommendations:u,metadata:m,isLoading:g,error:I,preferences:N,updateFilters:f,updatePreferences:j,refetch:S}=vr(Sr),[w,T]=l.useState([]),[D,H]=l.useState(!0);l.useEffect(()=>{(async()=>{try{const k=await fetch("/api/user/purchases",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(k.ok){const F=await k.json();console.log("🐛 DEBUG: Raw API response:",F),F.success?(console.log("🐛 DEBUG: First purchase:",F.purchases[0]),T(F.purchases.map($=>{console.log("🐛 DEBUG: Processing purchase:",$);const ee=$.purchaseInfo?.amountPaid||$.template?.price||0;return{...$.template,purchased:!0,amountPaid:ee,price:$.template?.price||0,purchaseInfo:$.purchaseInfo,purchasedAt:$.purchaseInfo?.purchasedAt,status:$.purchaseInfo?.status||"completed"}}))):console.error("❌ API returned success: false",F)}else console.error("❌ API response not ok:",k.status,k.statusText)}catch(k){console.error("❌ Error fetching purchases:",k),L.error("Failed to load your templates. Please try refreshing the page.")}finally{H(!1)}})()},[]);const M=Math.ceil(w.length/o),v=w.slice((h-1)*o,h*o),G=Math.ceil(u.length/d),U=u.slice((n-1)*d,n*d),V=y=>{p(y),document.getElementById("my-templates")?.scrollIntoView({behavior:"smooth"})},ue=()=>{h>1&&p(h-1)},Ae=()=>{h<M&&p(h+1)},he=y=>{c(y),document.getElementById("recommendations-grid")?.scrollIntoView({behavior:"smooth"})},Je=()=>{n>1&&c(n-1)},Ve=()=>{n<G&&c(n+1)};console.log("🔍 DEBUG: Starting total calculation"),console.log("🔍 DEBUG: purchasedTemplates array:",w),console.log("🔍 DEBUG: purchasedTemplates length:",w.length),w.length>0&&console.log("🔍 DEBUG: First template:",w[0]);const re=w.reduce((y,k)=>y+(k.amountPaid||0),0);console.log("🔍 FINAL totalSpent:",re),console.log("🔍 FINAL totalSpent in dollars:",(re/100).toFixed(2));const pe=y=>{j(y),L.success("Preferences updated! Refreshing recommendations...")},Ie=y=>{f(y)},q={personalized:m?.personalized||!1,trendingBoost:m?.trending_boost_applied||!1,filtersApplied:Object.keys(m?.filters_applied||{}).length,totalRecommendations:m?.total||0},qe=()=>{H(!0),window.location.reload()},We=y=>{T(F=>F.filter($=>$.id!==y));const k=w.length-1;L.success(`Template removed! ${k} templates remaining`)};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Q,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"My Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"AI-powered automation templates tailored for you"})]}),q.personalized&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(B,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:[e.jsx(fe,{className:"h-3 w-3 mr-1"}),"AI Personalized"]}),q.trendingBoost&&e.jsxs(B,{variant:"secondary",className:"bg-green-100 text-green-800",children:[e.jsx(me,{className:"h-3 w-3 mr-1"}),"Trending Boost"]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>r(!a),className:"flex items-center space-x-2",children:[e.jsx(tt,{className:"h-4 w-4"}),e.jsx("span",{children:"Personalize"})]}),e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>x(!i),className:"flex items-center space-x-2",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx("span",{children:"Filters"}),q.filtersApplied>0&&e.jsx(B,{variant:"secondary",className:"ml-1 h-5 w-5 rounded-full p-0 text-xs",children:q.filtersApplied})]}),e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>S(),className:"flex items-center space-x-2",children:[e.jsx(cs,{className:"h-4 w-4"}),e.jsx("span",{children:"Refresh"})]})]})]}),e.jsxs(wr,{value:s,onValueChange:t,className:"w-full",children:[e.jsxs(Pt,{className:"grid w-full grid-cols-3",children:[e.jsx(Le,{value:"overview",children:"Overview"}),e.jsx(Le,{value:"recommendations",children:"Smart Recommendations"}),e.jsx(Le,{value:"analytics",children:"Analytics"})]}),e.jsxs(_e,{value:"overview",className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(P,{children:[e.jsxs(E,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Templates Purchased"}),e.jsx(Js,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsx("div",{className:"text-2xl font-bold",children:w.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+2 from last month"})]})]}),e.jsxs(P,{children:[e.jsxs(E,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Total Spent"}),e.jsx(me,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",(re/100).toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+$39.99 from last month"})]})]}),e.jsxs(P,{children:[e.jsxs(E,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Smart Recommendations"}),e.jsx(fe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsx("div",{className:"text-2xl font-bold",children:q.totalRecommendations}),e.jsx("p",{className:"text-xs text-muted-foreground",children:q.personalized?"Personalized for you":"General recommendations"})]})]}),e.jsxs(P,{children:[e.jsxs(E,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Avg Rating Given"}),e.jsx(Be,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"4.8"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Based on 3 reviews"})]})]})]}),(a||i)&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a&&e.jsx(fs,{onPreferencesUpdate:pe}),i&&e.jsx(gs,{onFiltersChange:Ie})]}),e.jsxs("div",{id:"my-templates",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"My Templates"}),w.length>0&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Showing ",(h-1)*o+1,"-",Math.min(h*o,w.length)," of ",w.length," templates"]})]}),e.jsx(b,{variant:"outline",children:"View All Purchases"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:D?Array.from({length:3}).map((y,k)=>e.jsx(P,{className:"animate-pulse",children:e.jsxs(A,{className:"p-6",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded mb-4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]})},k)):v.length>0?v.map(y=>e.jsx(Fe,{template:y,onTemplateRemoved:We},y.id)):e.jsxs("div",{className:"col-span-full text-center py-8 text-gray-600",children:[e.jsx("div",{children:"No templates purchased yet. Browse our collection to get started!"}),e.jsx(b,{variant:"outline",size:"sm",onClick:qe,className:"mt-4",children:"Retry Loading Templates"})]})}),M>1&&e.jsxs("div",{className:"flex items-center justify-center space-x-2 mt-8",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:ue,disabled:h===1,className:"flex items-center space-x-1",children:[e.jsx(ss,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:M},(y,k)=>k+1).map(y=>e.jsx(b,{variant:h===y?"default":"outline",size:"sm",onClick:()=>V(y),className:"w-10 h-10 p-0",children:y},y))}),e.jsxs(b,{variant:"outline",size:"sm",onClick:Ae,disabled:h===M,className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Next"}),e.jsx(Oe,{className:"h-4 w-4"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center space-x-2",children:[e.jsx(cs,{className:"h-6 w-6 text-blue-600"}),e.jsx("span",{children:"Recommended for You"})]}),e.jsx(b,{onClick:()=>t("recommendations"),variant:"outline",children:"View All Recommendations"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:g?Array.from({length:3}).map((y,k)=>e.jsx(P,{className:"animate-pulse",children:e.jsxs(A,{className:"p-6",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded mb-4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]})},k)):I?e.jsxs("div",{className:"col-span-full text-center py-8 text-red-500",children:["Error loading recommendations: ",I.message]}):u.length>0?u.slice(0,3).map(y=>e.jsx(Fe,{template:y},y.id)):e.jsx("div",{className:"col-span-full text-center py-8 text-gray-600",children:"No recommendations available. Try updating your preferences!"})})]})]}),e.jsxs(_e,{value:"recommendations",className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center space-x-2",children:[e.jsx(fe,{className:"h-6 w-6 text-blue-600"}),e.jsx("span",{children:"Smart Recommendations"})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"AI-powered suggestions based on your preferences and behavior"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>r(!a),children:[e.jsx(ha,{className:"h-4 w-4 mr-2"}),"Setup"]}),e.jsx(J,{to:"/",children:e.jsx(b,{variant:"outline",children:"Browse All"})})]})]}),m&&e.jsx(P,{children:e.jsx(A,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ls,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"text-sm font-medium",children:[m.total," templates found"]})]}),m.personalized&&e.jsx(B,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:"Personalized"}),m.trending_boost_applied&&e.jsx(B,{variant:"secondary",className:"bg-green-100 text-green-800",children:"Trending Boost"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Updated ",new Date().toLocaleTimeString()]})]})})}),(a||i)&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a&&e.jsx(fs,{onPreferencesUpdate:pe}),i&&e.jsx(gs,{onFiltersChange:Ie})]}),e.jsxs("div",{id:"recommendations-grid",children:[U.length>0&&e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",(n-1)*d+1,"-",Math.min(n*d,u.length)," of ",u.length," recommendations"]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:g?Array.from({length:9}).map((y,k)=>e.jsx(P,{className:"animate-pulse",children:e.jsxs(A,{className:"p-6",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded mb-4"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})},k)):I?e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"text-red-500 mb-4",children:"Error loading recommendations"}),e.jsx(b,{onClick:()=>S(),variant:"outline",children:"Try Again"})]}):U.length>0?U.map((y,k)=>e.jsxs("div",{className:"relative",children:[e.jsx(Fe,{template:y}),y._recommendationScore&&!1]},y.id)):e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx(fe,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No recommendations found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Try adjusting your filters or setting up your business preferences"}),e.jsx(b,{onClick:()=>r(!0),children:"Setup Preferences"})]})}),G>1&&e.jsxs("div",{className:"flex items-center justify-center space-x-2 mt-8",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:Je,disabled:n===1,className:"flex items-center space-x-1",children:[e.jsx(ss,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:G},(y,k)=>k+1).map(y=>e.jsx(b,{variant:n===y?"default":"outline",size:"sm",onClick:()=>he(y),className:"w-10 h-10 p-0",children:y},y))}),e.jsxs(b,{variant:"outline",size:"sm",onClick:Ve,disabled:n===G,className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Next"}),e.jsx(Oe,{className:"h-4 w-4"})]})]})]})]}),e.jsxs(_e,{value:"analytics",className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[e.jsx($e,{className:"h-6 w-6 text-blue-600"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Recommendation Analytics"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(P,{children:[e.jsx(E,{children:e.jsx(R,{className:"text-lg",children:"Your Interests"})}),e.jsx(A,{children:e.jsx("div",{className:"space-y-2",children:N.preferredCategories?.slice(0,5).map(y=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:y.replace("_"," ").replace(/\b\w/g,k=>k.toUpperCase())}),e.jsx(B,{variant:"outline",children:Math.floor(Math.random()*10)+1})]},y))||e.jsx("p",{className:"text-gray-600 text-sm",children:"Set up preferences to see insights"})})})]}),e.jsxs(P,{children:[e.jsx(E,{children:e.jsx(R,{className:"text-lg",children:"Recommendation Performance"})}),e.jsx(A,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Personalization"}),e.jsx(B,{variant:q.personalized?"default":"secondary",children:q.personalized?"ON":"OFF"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Trending Boost"}),e.jsx(B,{variant:q.trendingBoost?"default":"secondary",children:q.trendingBoost?"ACTIVE":"INACTIVE"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Active Filters"}),e.jsx(B,{variant:"outline",children:q.filtersApplied})]})]})})]}),e.jsxs(P,{children:[e.jsx(E,{children:e.jsx(R,{className:"text-lg",children:"Spending Insights"})}),e.jsx(A,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Total Spent"}),e.jsxs("span",{className:"font-medium",children:["$",(re/100).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Avg per Template"}),e.jsxs("span",{className:"font-medium",children:["$",w.length>0?(re/w.length/100).toFixed(2):"0.00"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Budget Range"}),e.jsxs("span",{className:"font-medium",children:["$",(N.maxPrice||5e3)/100,"/template"]})]})]})})]})]})]})]})]})]})},Cr=()=>e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Q,{}),e.jsx("section",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white py-16",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[e.jsx("h1",{className:"text-4xl font-bold mb-4",children:"How to Use DevHubConnect"}),e.jsx("p",{className:"text-xl text-blue-100",children:"Your complete guide to discovering, purchasing, and using automation templates securely"})]})}),e.jsx("section",{className:"py-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs(P,{className:"mb-8",children:[e.jsxs(E,{children:[e.jsxs(R,{className:"flex items-center",children:[e.jsx(be,{className:"w-6 h-6 mr-2 text-green-600"}),"Quick Start Guide"]}),e.jsx(X,{children:"Get started in 3 simple steps with secure GitHub authentication"})]}),e.jsx(A,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-blue-600 font-bold text-lg",children:"1"})}),e.jsx("h3",{className:"font-semibold mb-2",children:"Browse Templates"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Explore our collection of automation templates on the homepage"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-purple-600 font-bold text-lg",children:"2"})}),e.jsx("h3",{className:"font-semibold mb-2",children:"Sign In & Purchase"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Sign in with GitHub to securely purchase templates - authentication required"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-green-600 font-bold text-lg",children:"3"})}),e.jsx("h3",{className:"font-semibold mb-2",children:"Access & Use"}),e.jsx("p",{className:"text-sm text-gray-600",children:"View your purchased templates in your personal dashboard"})]})]})})]}),e.jsxs(P,{className:"mb-8",children:[e.jsx(E,{children:e.jsxs(R,{className:"flex items-center",children:[e.jsx(Ne,{className:"w-6 h-6 mr-2 text-blue-600"}),"Browsing & Finding Templates"]})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(ds,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Homepage Navigation"}),e.jsx("p",{className:"text-gray-600",children:"The homepage displays all available templates in a clean grid layout. Each template card shows the name, description, price, and app icons."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Ne,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Search Function"}),e.jsx("p",{className:"text-gray-600",children:"Use the search bar at the top to find templates by name or description. Type keywords related to what you're looking for."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Se,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Category Filters"}),e.jsx("p",{className:"text-gray-600",children:'Click on category badges (email, database, webhooks, etc.) to filter templates by type. Click "all" to reset filters.'})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(De,{className:"w-5 h-5 mr-2 text-blue-600"}),e.jsx("span",{className:"font-semibold text-blue-900",children:"Pro Tip"})]}),e.jsx("p",{className:"text-blue-800",children:"Look for the app icons on each template card to quickly identify which services the automation works with (Gmail, Slack, Stripe, etc.)."})]})]})]}),e.jsxs(P,{className:"mb-8",children:[e.jsx(E,{children:e.jsxs(R,{className:"flex items-center",children:[e.jsx(te,{className:"w-6 h-6 mr-2 text-purple-600"}),"Understanding Template Details"]})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(ds,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Clicking on Templates"}),e.jsx("p",{className:"text-gray-600",children:"Click anywhere on a template card to open the detailed view page where you can see more information and the workflow diagram."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(ms,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Workflow Visualization"}),e.jsx("p",{className:"text-gray-600",children:"The template detail page shows a visual diagram of how the automation works, with connected boxes representing each step in the process."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(De,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Template Information"}),e.jsx("p",{className:"text-gray-600",children:"Each template page includes the full description, pricing, and all technical details you need to understand what the automation does."})]})]})]})]}),e.jsxs(P,{className:"mb-8",children:[e.jsxs(E,{children:[e.jsxs(R,{className:"flex items-center",children:[e.jsx(se,{className:"w-6 h-6 mr-2 text-gray-900"}),"GitHub Authentication"]}),e.jsx(X,{children:"Secure, one-click authentication powered by GitHub"})]}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(se,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Sign In with GitHub"}),e.jsx("p",{className:"text-gray-600",children:'Click "Continue with GitHub" to sign in securely. Your GitHub account is used to create and access your DevHubConnect profile automatically.'})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(K,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Automatic Account Creation"}),e.jsx("p",{className:"text-gray-600",children:"No separate registration needed! Your account is created automatically when you first sign in with GitHub, using your GitHub profile information."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Ks,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Profile & Dashboard Access"}),e.jsx("p",{className:"text-gray-600",children:`After signing in, you'll see your GitHub username in the top-right corner. Click it to access "My Templates" and view your purchases.`})]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(be,{className:"w-5 h-5 mr-2 text-green-600"}),e.jsx("span",{className:"font-semibold text-green-900",children:"Why GitHub?"})]}),e.jsx("p",{className:"text-green-800",children:"GitHub authentication ensures your purchases are securely linked to your account and prevents any payment/access issues. It's the most reliable way to protect your investment."})]})]})]}),e.jsxs(P,{className:"mb-8",children:[e.jsxs(E,{children:[e.jsxs(R,{className:"flex items-center",children:[e.jsx(Ke,{className:"w-6 h-6 mr-2 text-red-600"}),"Secure Template Purchasing"]}),e.jsx(X,{children:"Protected checkout process with authentication verification"})]}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Ke,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-600",children:"You MUST be signed in with GitHub to purchase templates. This ensures your purchase is properly linked to your account and prevents any loss of access."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(K,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Duplicate Purchase Prevention"}),e.jsx("p",{className:"text-gray-600",children:"Our system automatically prevents you from purchasing the same template twice, protecting you from accidental duplicate charges."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(pa,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Secure Payment Processing"}),e.jsx("p",{className:"text-gray-600",children:"All payments are processed securely through Stripe with end-to-end encryption. Your payment information is never stored on our servers."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(we,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Instant Secure Access"}),e.jsx("p",{className:"text-gray-600",children:"After successful payment, templates are immediately available in your dashboard, securely linked to your GitHub account for lifetime access."})]})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(ve,{className:"w-5 h-5 mr-2 text-red-600"}),e.jsx("span",{className:"font-semibold text-red-900",children:"Critical Security Notice"})]}),e.jsx("p",{className:"text-red-800",children:"Purchasing without being signed in is not possible. This security measure protects your money and ensures you can always access your purchased templates."})]})]})]}),e.jsxs(P,{className:"mb-8",children:[e.jsx(E,{children:e.jsxs(R,{className:"flex items-center",children:[e.jsx(as,{className:"w-6 h-6 mr-2 text-indigo-600"}),"Your Secure Dashboard"]})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(se,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"GitHub-Linked Templates"}),e.jsx("p",{className:"text-gray-600",children:"Your dashboard shows all templates purchased with your GitHub account. Each purchase is securely linked to prevent any access issues."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(we,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Download & Use Templates"}),e.jsx("p",{className:"text-gray-600",children:"From your dashboard, you can download template files, view detailed workflow information, and access setup instructions for your automation tools."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(be,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Permanent Access"}),e.jsx("p",{className:"text-gray-600",children:"Once purchased, templates remain in your dashboard forever. As long as you can access your GitHub account, you can access your templates."})]})]}),e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(De,{className:"w-5 h-5 mr-2 text-indigo-600"}),e.jsx("span",{className:"font-semibold text-indigo-900",children:"Access Your Dashboard"})]}),e.jsx("p",{className:"text-indigo-800",children:'After signing in with GitHub, look for your username/avatar in the top-right corner and click "My Templates" to view your purchased automation templates.'})]})]})]}),e.jsxs(P,{className:"mb-8",children:[e.jsx(E,{children:e.jsxs(R,{className:"flex items-center",children:[e.jsx(ve,{className:"w-6 h-6 mr-2 text-yellow-600"}),"Troubleshooting & Common Issues"]})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Ke,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Can't Purchase Templates"}),e.jsx("p",{className:"text-gray-600",children:"If purchase buttons don't work, make sure you're signed in with GitHub first. Unauthenticated users cannot make purchases for security reasons."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Ne,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Don't See Your Templates"}),e.jsx("p",{className:"text-gray-600",children:"Templates are linked to your GitHub account. Make sure you're signed in with the same GitHub account you used to make the purchase."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(se,{className:"w-5 h-5 mt-1 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"GitHub Sign-In Issues"}),e.jsx("p",{className:"text-gray-600",children:"If GitHub authentication fails, try clearing your browser cache or using an incognito/private browsing window."})]})]})]})]}),e.jsxs(P,{children:[e.jsx(E,{children:e.jsxs(R,{className:"flex items-center",children:[e.jsx(De,{className:"w-6 h-6 mr-2 text-blue-600"}),"Need More Help?"]})}),e.jsxs(A,{children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"If you're still having trouble or have questions not covered in this guide, here are ways to get additional support:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(se,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-gray-700",children:"Ensure you're signed in with GitHub before attempting any purchases"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(K,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-gray-700",children:"Check that your GitHub account email matches your purchase email"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(te,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-gray-700",children:"Preview templates thoroughly before purchasing to ensure they meet your needs"})]})]}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx(J,{to:"/",children:e.jsxs(b,{className:"mr-4",children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Start Browsing Templates"]})}),e.jsx(J,{to:"/auth",children:e.jsxs(b,{variant:"outline",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Sign In with GitHub"]})})]})]})]})]})})]}),Tr=()=>{const s=Ce();return l.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",s.pathname)},[s.pathname]),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),e.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},Pr=()=>{const s=Ce(),[t,a]=l.useState("loading"),[r,i]=l.useState("Verifying your payment...");return l.useEffect(()=>{const o=new URLSearchParams(s.search).get("session_id"),h=async p=>{try{const d=await fetch(`/api/stripe/verify-payment?session_id=${p}`),n=await d.json();d.ok&&n.status==="paid"?(a("success"),i("Payment successful! Your template is now available for download.")):(a("failed"),i(n.message||"Payment could not be verified. Please contact support."))}catch(d){console.error("Payment verification error:",d),a("failed"),i("An error occurred during payment verification.")}};o?(console.log("Stripe Session ID:",o),h(o)):(a("failed"),i("No payment session ID found. Payment status cannot be determined."))},[s]),e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(Q,{}),e.jsx("main",{className:"flex-grow container mx-auto px-4 py-12 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center max-w-md w-full",children:[t==="loading"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Processing Payment..."}),e.jsx("p",{className:"text-gray-600",children:r})]}),t==="success"&&e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-green-700 mb-2",children:"Success!"}),e.jsx("p",{className:"text-gray-700 mb-6",children:r}),e.jsx(J,{to:"/dashboard",children:e.jsx(b,{className:"bg-blue-600 hover:bg-blue-700",children:"Go to Dashboard"})})]}),t==="failed"&&e.jsxs(e.Fragment,{children:[e.jsx(fa,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-red-700 mb-2",children:"Payment Failed"}),e.jsx("p",{className:"text-gray-700 mb-6",children:r}),e.jsx(J,{to:"/",children:e.jsx(b,{variant:"outline",children:"Back to Home"})})]})]})})]})};function Ar(){const[s,t]=l.useState(null),[a,r]=l.useState(!0),[i,x]=l.useState(null),o=Z(),{currentUser:h}=ae(),p=h&&(h.role==="admin"||h.isAdmin);l.useEffect(()=>{p?d():(x("Admin privileges required to view analytics"),r(!1))},[p]);const d=async()=>{try{const n=await fetch("/api/admin/analytics-data",{credentials:"include"});if(!n.ok)throw new Error("Failed to fetch analytics data");const c=await n.json();t(c.data)}catch{x("Failed to load analytics data")}finally{r(!1)}};return a?e.jsx("div",{className:"container mx-auto py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{children:"Loading analytics..."})]})}):i||!p?e.jsx("div",{className:"container mx-auto py-8",children:e.jsx(P,{className:"max-w-md mx-auto",children:e.jsx(A,{className:"pt-6",children:e.jsxs("div",{className:"text-center text-red-600",children:[e.jsx($e,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-sm mb-4",children:i||"Admin privileges required"}),e.jsx("button",{onClick:()=>o("/admin/dashboard"),className:"text-blue-600 hover:text-blue-800 underline",children:"Return to Admin Dashboard"})]})})})}):s?e.jsxs("div",{className:"container mx-auto py-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Overview of marketplace performance and user behavior"})]}),e.jsxs(b,{onClick:()=>o("/admin/dashboard"),variant:"outline",className:"flex items-center",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Back to Admin"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(P,{children:e.jsx(A,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Revenue"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",(s.revenueStats.totalRevenue/100).toFixed(2)]})]}),e.jsx(xs,{className:"w-8 h-8 text-green-600"})]})})}),e.jsx(P,{children:e.jsx(A,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Sales"}),e.jsx("p",{className:"text-2xl font-bold",children:s.revenueStats.totalSales})]}),e.jsx(me,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(P,{children:e.jsx(A,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold",children:s.userStats.totalUsers})]}),e.jsx(ns,{className:"w-8 h-8 text-purple-600"})]})})}),e.jsx(P,{children:e.jsx(A,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active Users"}),e.jsx("p",{className:"text-2xl font-bold",children:s.userStats.activeUsers})]}),e.jsx(te,{className:"w-8 h-8 text-orange-600"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs(P,{className:"lg:col-span-1",children:[e.jsx(E,{children:e.jsxs(R,{className:"flex items-center",children:[e.jsx(Ne,{className:"w-5 h-5 mr-2"}),"Top Search Terms"]})}),e.jsx(A,{children:e.jsx("div",{className:"space-y-3",children:s.topSearchTerms&&s.topSearchTerms.length>0?s.topSearchTerms.map((n,c)=>e.jsxs("div",{className:"flex justify-between items-center p-2 rounded hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:n.searchTerm}),e.jsx("p",{className:"text-sm text-gray-600",children:"Search term"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold",children:n.searchCount}),e.jsx("p",{className:"text-sm text-gray-600",children:"searches"})]})]},c)):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No search data yet"})})})]}),e.jsxs(P,{className:"lg:col-span-2",children:[e.jsx(E,{children:e.jsxs(R,{className:"flex items-center",children:[e.jsx(me,{className:"w-5 h-5 mr-2"}),"Most Downloaded Templates"]})}),e.jsx(A,{children:e.jsx("div",{className:"space-y-3",children:s.popularByDownloads.slice(0,5).map((n,c)=>e.jsxs("div",{className:"flex justify-between items-center p-2 rounded hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:n.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["$",(n.price/100).toFixed(2)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold",children:[n.downloadCount," downloads"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[n.viewCount," views"]})]})]},n.id))})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(P,{children:[e.jsx(E,{children:e.jsxs(R,{className:"flex items-center",children:[e.jsx(xs,{className:"w-5 h-5 mr-2"}),"Top Revenue Generators"]})}),e.jsx(A,{children:e.jsx("div",{className:"space-y-3",children:s.popularByPurchases.slice(0,5).map((n,c)=>e.jsxs("div",{className:"flex justify-between items-center p-2 rounded hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:n.templateName}),e.jsx("p",{className:"text-sm text-gray-600",children:n.category||"General"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold",children:[n.purchaseCount," sales"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["$",(n.totalRevenue/100).toFixed(2)]})]})]},n.templateId))})})]}),e.jsxs(P,{children:[e.jsx(E,{children:e.jsxs(R,{className:"flex items-center",children:[e.jsx($e,{className:"w-5 h-5 mr-2"}),"Category Performance"]})}),e.jsx(A,{children:e.jsx("div",{className:"space-y-4",children:s.categoryStats.map((n,c)=>e.jsxs("div",{className:"flex justify-between items-center p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium capitalize",children:n.category||"Uncategorized"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[n.templateCount," templates"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold",children:[n.totalDownloads," downloads"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Avg rating: ",n.avgRating?Number(n.avgRating).toFixed(1):"N/A"]})]})]},c))})})]})]}),e.jsxs(P,{className:"bg-blue-50 border-blue-200",children:[e.jsx(E,{children:e.jsx(R,{className:"text-blue-800",children:"💡 Key Insights"})}),e.jsx(A,{children:e.jsxs("div",{className:"text-blue-700",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Search Terms"})," show you what workflows users want but can't find - create templates for popular search terms!"]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Download vs Views"})," ratio shows conversion rates - low ratios may indicate pricing or quality issues."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Category Performance"})," helps you identify which workflow types to focus on for maximum impact."]})]})})]})]}):e.jsx("div",{className:"container mx-auto py-8",children:e.jsx("div",{className:"text-center text-red-600",children:"No analytics data available"})})}const Ir=()=>{const s=Z(),[t]=ga(),{login:a,checkSession:r}=ae(),[i,x]=l.useState(!0),[o,h]=l.useState(null),[p,d]=l.useState("validating");if(l.useEffect(()=>{const u=setTimeout(async()=>{try{console.log("🔗 Processing OAuth callback..."),console.log("🔍 Current URL:",window.location.search),d("validating");const m=t.get("success"),g=t.get("userId"),I=t.get("userName"),N=t.get("userEmail"),f=t.get("error");if(console.log("🔍 OAuth params:",{success:m,userId:g,userName:I,userEmail:N,oauthError:f}),m==="false"||f){console.log("❌ OAuth failed:",f),h("GitHub authentication failed. Please try again."),x(!1);return}if(!g||!I){console.log("❌ Missing OAuth parameters"),h("Missing authentication parameters. Please try logging in again."),x(!1);return}console.log("✅ OAuth parameters valid"),d("session_sync"),console.log("⏳ Waiting for backend session..."),await new Promise(j=>setTimeout(j,2e3));try{console.log("🔄 Checking backend session...");const j=await fetch("/auth/profile/session",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(j.ok){const w=await j.json();if(w.success&&w.user){console.log("✅ Backend session found:",w.user.email||w.user.name);const T={id:w.user.id,email:w.user.email,name:w.user.name,role:w.user.role,isAdmin:w.user.role==="admin",username:w.user.name,github_id:w.user.id};a("cookie-session",T),d("complete"),x(!1),L.success("Login successful! Welcome to DevHub Connect"),setTimeout(()=>{console.log("🔄 Redirecting to dashboard..."),s("/dashboard",{replace:!0})},1500);return}}console.log("⚠️ No backend session found, using URL parameters as fallback"),a("fallback-session",{id:g,email:N||"",name:I,role:"user",isAdmin:!1,username:I,github_id:g}),d("complete"),x(!1),L.success("Login successful! Welcome to DevHub Connect"),setTimeout(()=>{console.log("🔄 Redirecting to dashboard..."),s("/dashboard",{replace:!0})},1500)}catch(j){console.error("❌ Session processing error:",j),h("Session setup failed. Please try logging in again."),x(!1)}}catch(m){console.error("❌ OAuth processing error:",m),h("Authentication processing failed. Please try again."),x(!1)}},500);return()=>clearTimeout(u)},[t,a,s,r]),o)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-md p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 text-center mb-2",children:"Authentication Failed"}),e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:o}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>window.location.href="/auth/github",className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:"Try Again"}),e.jsx("button",{onClick:()=>s("/"),className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-300 transition-colors",children:"Go Home"})]})]})});const n=c=>{switch(c){case"validating":return"Validating GitHub authentication...";case"session_sync":return"Syncing with backend session...";case"complete":return"Authentication complete!";default:return"Processing..."}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"max-w-md w-full bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-blue-100 rounded-full mb-4",children:e.jsxs("svg",{className:"animate-spin w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:i?"Completing Authentication...":"Authentication Successful!"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:i?n(p):"Redirecting to your dashboard..."}),e.jsxs("div",{className:"space-y-2 text-left",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-3"}),e.jsx("span",{className:"text-gray-600",children:"GitHub authentication verified"})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-3"}),e.jsx("span",{className:"text-gray-600",children:"User account located"})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mr-3 ${p==="session_sync"?"bg-blue-500 animate-pulse":p==="complete"?"bg-green-500":"bg-gray-300"}`}),e.jsx("span",{className:"text-gray-600",children:"Syncing with backend..."})]})]}),!i&&e.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:["If you're not redirected automatically, ",e.jsx("button",{onClick:()=>s("/dashboard"),className:"text-blue-600 hover:underline",children:"click here"}),"."]}),e.jsxs("div",{className:"mt-4 text-xs text-gray-400",children:["Step: ",p]})]})})})},Dr=()=>e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Q,{}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(P,{children:[e.jsx(E,{children:e.jsx(R,{children:"Profile"})}),e.jsx(A,{children:e.jsx("p",{children:"Profile page coming soon..."})})]})})]}),Er=()=>e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Q,{}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(P,{children:[e.jsx(E,{children:e.jsx(R,{children:"Settings"})}),e.jsx(A,{children:e.jsx("p",{children:"Settings page coming soon..."})})]})})]}),Rr=()=>e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Q,{}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-md",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Terms of Service"}),e.jsxs("div",{className:"prose max-w-none",children:[e.jsxs("p",{className:"text-gray-600 mb-4",children:["Last updated: ",new Date().toLocaleDateString()]}),e.jsx("h2",{className:"text-xl font-semibold mt-6 mb-3",children:"1. Acceptance of Terms"}),e.jsx("p",{children:'By accessing and using DevHubConnect ("the Service"), you accept and agree to be bound by the terms and provision of this agreement.'}),e.jsx("h2",{className:"text-xl font-semibold mt-6 mb-3",children:"2. Description of Service"}),e.jsx("p",{children:"DevHubConnect is a marketplace for n8n automation workflow templates. Users can purchase and download JSON workflow files for use in their n8n instances."}),e.jsx("h2",{className:"text-xl font-semibold mt-6 mb-3",children:"3. User Accounts"}),e.jsx("p",{children:"To use certain features of the Service, you must register for an account. You are responsible for maintaining the confidentiality of your account credentials."}),e.jsx("h2",{className:"text-xl font-semibold mt-6 mb-3",children:"4. Purchases and Payments"}),e.jsx("p",{children:"All purchases are processed through Stripe. Payments are final and non-refundable except as required by law. Digital products are delivered immediately upon successful payment."}),e.jsx("h2",{className:"text-xl font-semibold mt-6 mb-3",children:"5. Intellectual Property"}),e.jsx("p",{children:"Workflow templates remain the intellectual property of their creators. Purchase grants you a non-exclusive license to use the workflows for your personal or commercial projects."}),e.jsx("h2",{className:"text-xl font-semibold mt-6 mb-3",children:"6. Prohibited Uses"}),e.jsx("p",{children:"You may not:"}),e.jsxs("ul",{className:"list-disc ml-6 mb-4",children:[e.jsx("li",{children:"Resell or redistribute purchased workflows"}),e.jsx("li",{children:"Use the service for illegal purposes"}),e.jsx("li",{children:"Attempt to reverse engineer or hack the platform"})]}),e.jsx("h2",{className:"text-xl font-semibold mt-6 mb-3",children:"7. Disclaimers"}),e.jsx("p",{children:'Workflows are provided "as is" without warranty. DevHubConnect is not liable for any damages resulting from the use of purchased workflows.'}),e.jsx("h2",{className:"text-xl font-semibold mt-6 mb-3",children:"8. Contact Information"}),e.jsx("p",{children:"For questions about these Terms, contact us at: devhub.partners@gmail.com"})]})]})})]}),Ur=()=>e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Q,{}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-md",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Privacy Policy"}),e.jsxs("div",{className:"prose max-w-none",children:[e.jsxs("p",{className:"text-gray-600 mb-4",children:["Last updated: ",new Date().toLocaleDateString()]}),e.jsx("h2",{className:"text-xl font-semibold mt-6 mb-3",children:"1. Information We Collect"}),e.jsx("p",{children:"We collect information you provide directly to us, such as when you create an account, make a purchase, or contact us for support."}),e.jsx("h2",{className:"text-xl font-semibold mt-6 mb-3",children:"2. Information Collected Automatically"}),e.jsx("p",{children:"We automatically collect certain information about your device and usage patterns, including:"}),e.jsxs("ul",{className:"list-disc ml-6 mb-4",children:[e.jsx("li",{children:"IP address and browser information"}),e.jsx("li",{children:"Pages visited and time spent on the site"}),e.jsx("li",{children:"Search queries and template interactions"})]}),e.jsx("h2",{className:"text-xl font-semibold mt-6 mb-3",children:"3. How We Use Your Information"}),e.jsx("p",{children:"We use the information we collect to:"}),e.jsxs("ul",{className:"list-disc ml-6 mb-4",children:[e.jsx("li",{children:"Process transactions and deliver purchased content"}),e.jsx("li",{children:"Improve our services and user experience"}),e.jsx("li",{children:"Send important updates about your account"}),e.jsx("li",{children:"Analyze usage patterns and marketplace trends"})]}),e.jsx("h2",{className:"text-xl font-semibold mt-6 mb-3",children:"4. Information Sharing"}),e.jsx("p",{children:"We do not sell, trade, or rent your personal information to third parties. We may share information with:"}),e.jsxs("ul",{className:"list-disc ml-6 mb-4",children:[e.jsx("li",{children:"Payment processors (Stripe) to process transactions"}),e.jsx("li",{children:"Service providers who assist in operating our platform"}),e.jsx("li",{children:"Law enforcement when required by law"})]}),e.jsx("h2",{className:"text-xl font-semibold mt-6 mb-3",children:"5. Data Security"}),e.jsx("p",{children:"We implement appropriate security measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction."}),e.jsx("h2",{className:"text-xl font-semibold mt-6 mb-3",children:"6. Cookies"}),e.jsx("p",{children:"We use cookies to enhance your experience, analyze site usage, and assist in our marketing efforts. You can control cookie settings through your browser."}),e.jsx("h2",{className:"text-xl font-semibold mt-6 mb-3",children:"7. Your Rights"}),e.jsx("p",{children:"You have the right to access, update, or delete your personal information. Contact us to exercise these rights."}),e.jsx("h2",{className:"text-xl font-semibold mt-6 mb-3",children:"8. Contact Us"}),e.jsx("p",{children:"If you have questions about this Privacy Policy, contact us at: devhub.partners@gmail.com"})]})]})})]}),Fr=()=>e.jsx("footer",{className:"w-full text-sm text-white py-6 px-4 mt-10 bg-gradient-to-r from-blue-600 to-purple-600 border-none",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex flex-col md:flex-row justify-between gap-4",children:[e.jsx("div",{children:e.jsxs("p",{children:["© ",new Date().getFullYear()," DevHubConnect. All rights reserved."]})}),e.jsxs("div",{className:"max-w-xl",children:[e.jsxs("p",{className:"mb-4",children:[e.jsx("strong",{children:"Disclaimer:"}),' The automation templates provided by DevHubConnect are made available for informational and productivity purposes only. DevHubConnect does not guarantee the accuracy, reliability, completeness, or suitability of these templates for any particular purpose. Templates are provided "as-is" without any warranties. Users are responsible for testing and validating templates before deployment. Use is at your own risk. DevHubConnect is not liable for any damages, losses, security breaches, or issues resulting from their use.']}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx(J,{to:"/terms",className:"text-blue-200 hover:text-white underline transition-colors",children:"Terms of Service"}),e.jsx(J,{to:"/privacy",className:"text-blue-200 hover:text-white underline transition-colors",children:"Privacy Policy"}),e.jsx("a",{href:"mailto:devhub.partners@gmail.com",className:"text-blue-200 hover:text-white underline transition-colors",children:"Contact Us"})]})]})]})}),Lr=()=>{const[s,t]=Qe.useState(null),[a,r]=Qe.useState(!0),{currentUser:i,token:x,isLoading:o}=ae();return Qe.useEffect(()=>{(()=>{try{if(i&&x){t({id:i.id,email:i.email,role:i.isAdmin?"admin":"user",isAdmin:i.isAdmin||!1});return}const p=localStorage.getItem("token"),d=localStorage.getItem("admin_auth");if(p&&d==="true")try{const n=JSON.parse(atob(p.split(".")[1])),c=Math.floor(Date.now()/1e3);if(n.exp&&n.exp>c&&n.isAdmin){t({id:n.id||"admin_user_id",email:"admin@devhubconnect.com",role:"admin",isAdmin:!0});return}else localStorage.removeItem("token"),localStorage.removeItem("admin_auth")}catch(n){console.error("Invalid admin token format:",n),localStorage.removeItem("token"),localStorage.removeItem("admin_auth")}t(null)}catch(p){console.error("Auth check failed:",p),t(null)}finally{o||r(!1)}})()},[i,x,o]),{user:s,isLoading:a}},je=({children:s,requiredRole:t,requireAdmin:a=!1,requireCreatorOrAdmin:r=!1})=>{const{user:i,isLoading:x}=Lr();if(x)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Authenticating..."})]})});if(!i)return e.jsx(Ee,{to:"/login",replace:!0});const o=a||t==="admin",h=t==="user";if(o&&!i.isAdmin)return console.warn(`Access denied: User ${i.email} attempted to access admin route`),e.jsx(Ee,{to:"/admin",replace:!0});if(r&&!i.isAdmin)return console.warn(`Access denied: User ${i.email} attempted to access creator/admin route`),e.jsx(Ee,{to:"/dashboard",replace:!0});if(h&&!i)return console.warn("Access denied: No user for user-required route"),e.jsx(Ee,{to:"/login",replace:!0});const p=o?"admin":r?"creator/admin":h?"user":"protected";return console.log(`✅ Access granted: ${i.email} (${i.role}) → ${p} route`),e.jsx(e.Fragment,{children:s})},_r=new ja({defaultOptions:{queries:{retry:!1,refetchOnWindowFocus:!1}}}),es=({children:s})=>e.jsx(je,{requireAdmin:!0,children:s}),Or=()=>e.jsx(ba,{client:_r,children:e.jsx(bt,{children:e.jsxs(Ua,{children:[e.jsx(Ea,{}),e.jsx(Ra,{}),e.jsx(Na,{children:e.jsxs(e.Fragment,{children:[e.jsxs(ya,{children:[e.jsx(z,{path:"/",element:e.jsx(rr,{})}),e.jsx(z,{path:"/template/:id",element:e.jsx(cr,{})}),e.jsx(z,{path:"/guidance",element:e.jsx(Cr,{})}),e.jsx(z,{path:"/success",element:e.jsx(Pr,{})}),e.jsx(z,{path:"/terms",element:e.jsx(Rr,{})}),e.jsx(z,{path:"/privacy",element:e.jsx(Ur,{})}),e.jsx(z,{path:"/login",element:e.jsx(ps,{})}),e.jsx(z,{path:"/register",element:e.jsx(ps,{})}),e.jsx(z,{path:"/auth/success",element:e.jsx(Ir,{})}),e.jsx(z,{path:"/dashboard",element:e.jsx(je,{children:e.jsx(kr,{})})}),e.jsx(z,{path:"/profile",element:e.jsx(je,{children:e.jsx(Dr,{})})}),e.jsx(z,{path:"/settings",element:e.jsx(je,{children:e.jsx(Er,{})})}),e.jsx(z,{path:"/template/:id/edit",element:e.jsx(je,{requireCreatorOrAdmin:!0,children:e.jsx(hs,{})})}),e.jsx(z,{path:"/admin",element:e.jsx(hr,{})}),e.jsx(z,{path:"/admin/dashboard",element:e.jsx(es,{children:e.jsx(pr,{})})}),e.jsx(z,{path:"/admin/analytics",element:e.jsx(es,{children:e.jsx(Ar,{})})}),e.jsx(z,{path:"/admin/templates/:id/edit",element:e.jsx(es,{children:e.jsx(hs,{})})}),e.jsx(z,{path:"*",element:e.jsx(Tr,{})})]}),e.jsx(Fr,{})]})})]})})});wa.createRoot(document.getElementById("root")).render(e.jsx(bt,{children:e.jsx(Or,{})}));
